module.exports = {

"[project]/.next-internal/server/app/api/boards/route/actions.js [app-rsc] (server actions loader, ecmascript)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
}}),
"[externals]/next/dist/compiled/next-server/app-route-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-route-turbo.runtime.dev.js, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-route-turbo.runtime.dev.js", () => require("next/dist/compiled/next-server/app-route-turbo.runtime.dev.js"));

module.exports = mod;
}}),
"[externals]/next/dist/compiled/@opentelemetry/api [external] (next/dist/compiled/@opentelemetry/api, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/compiled/@opentelemetry/api", () => require("next/dist/compiled/@opentelemetry/api"));

module.exports = mod;
}}),
"[externals]/next/dist/compiled/next-server/app-page-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-page-turbo.runtime.dev.js, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-page-turbo.runtime.dev.js", () => require("next/dist/compiled/next-server/app-page-turbo.runtime.dev.js"));

module.exports = mod;
}}),
"[externals]/next/dist/server/app-render/work-unit-async-storage.external.js [external] (next/dist/server/app-render/work-unit-async-storage.external.js, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/server/app-render/work-unit-async-storage.external.js", () => require("next/dist/server/app-render/work-unit-async-storage.external.js"));

module.exports = mod;
}}),
"[externals]/next/dist/server/app-render/work-async-storage.external.js [external] (next/dist/server/app-render/work-async-storage.external.js, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/server/app-render/work-async-storage.external.js", () => require("next/dist/server/app-render/work-async-storage.external.js"));

module.exports = mod;
}}),
"[externals]/next/dist/server/app-render/after-task-async-storage.external.js [external] (next/dist/server/app-render/after-task-async-storage.external.js, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/server/app-render/after-task-async-storage.external.js", () => require("next/dist/server/app-render/after-task-async-storage.external.js"));

module.exports = mod;
}}),
"[externals]/buffer [external] (buffer, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("buffer", () => require("buffer"));

module.exports = mod;
}}),
"[externals]/stream [external] (stream, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("stream", () => require("stream"));

module.exports = mod;
}}),
"[externals]/util [external] (util, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("util", () => require("util"));

module.exports = mod;
}}),
"[externals]/crypto [external] (crypto, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("crypto", () => require("crypto"));

module.exports = mod;
}}),
"[externals]/pg [external] (pg, esm_import)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname, a: __turbopack_async_module__ } = __turbopack_context__;
__turbopack_async_module__(async (__turbopack_handle_async_dependencies__, __turbopack_async_result__) => { try {
const mod = await __turbopack_context__.y("pg");

__turbopack_context__.n(mod);
__turbopack_async_result__();
} catch(e) { __turbopack_async_result__(e); } }, true);}),
"[project]/src/lib/postgresql-adapter.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname, a: __turbopack_async_module__ } = __turbopack_context__;
__turbopack_async_module__(async (__turbopack_handle_async_dependencies__, __turbopack_async_result__) => { try {
__turbopack_context__.s({
    "PostgreSQLAdapter": (()=>PostgreSQLAdapter),
    "default": (()=>__TURBOPACK__default__export__),
    "getPostgreSQLAdapter": (()=>getPostgreSQLAdapter)
});
var __TURBOPACK__imported__module__$5b$externals$5d2f$pg__$5b$external$5d$__$28$pg$2c$__esm_import$29$__ = __turbopack_context__.i("[externals]/pg [external] (pg, esm_import)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$bcryptjs$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/bcryptjs/index.js [app-route] (ecmascript)");
var __turbopack_async_dependencies__ = __turbopack_handle_async_dependencies__([
    __TURBOPACK__imported__module__$5b$externals$5d2f$pg__$5b$external$5d$__$28$pg$2c$__esm_import$29$__
]);
([__TURBOPACK__imported__module__$5b$externals$5d2f$pg__$5b$external$5d$__$28$pg$2c$__esm_import$29$__] = __turbopack_async_dependencies__.then ? (await __turbopack_async_dependencies__)() : __turbopack_async_dependencies__);
;
;
class PostgreSQLAdapter {
    static instance = null;
    pool;
    isInitialized = false;
    constructor(config){
        this.pool = new __TURBOPACK__imported__module__$5b$externals$5d2f$pg__$5b$external$5d$__$28$pg$2c$__esm_import$29$__["Pool"]({
            host: config.host,
            port: config.port,
            database: config.database,
            user: config.user,
            password: config.password,
            ssl: config.ssl ? {
                rejectUnauthorized: false
            } : false,
            max: 20,
            idleTimeoutMillis: 30000,
            connectionTimeoutMillis: 2000
        });
    }
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
    async initialize() {
        if (this.isInitialized) return;
        try {
            const client = await this.pool.connect();
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
            await client.query('SELECT NOW()');
            console.log('‚úÖ PostgreSQL –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ');
            client.release();
            this.isInitialized = true;
        } catch (error) {
            console.error('‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ PostgreSQL:', error);
            throw error;
        }
    }
    // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø—É–ª–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
    async close() {
        await this.pool.end();
        this.isInitialized = false;
    }
    // –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞ –¥–ª—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
    async getClient() {
        return await this.pool.connect();
    }
    // –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞
    async query(text, params) {
        const client = await this.pool.connect();
        try {
            console.log('SQL Query:', text);
            console.log('SQL Params:', params);
            const result = await client.query(text, params);
            return result;
        } finally{
            client.release();
        }
    }
    // === –ú–ï–¢–û–î–´ –î–õ–Ø –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ï–ô ===
    async createUser(email, password, name, role = 'user') {
        const hashedPassword = await __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$bcryptjs$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"].hash(password, 12);
        const result = await this.query(`INSERT INTO users (email, password_hash, name, role, approval_status) 
       VALUES ($1, $2, $3, $4, $5) 
       RETURNING *`, [
            email,
            hashedPassword,
            name,
            role,
            'pending'
        ]);
        return result.rows[0];
    }
    async getUserByEmail(email) {
        const result = await this.query('SELECT * FROM users WHERE email = $1', [
            email
        ]);
        const row = result.rows[0];
        if (!row) return null;
        // –ú–∞–ø–ø–∏–Ω–≥ –ø–æ–ª–µ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –≤ User –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
        return {
            id: row.id,
            userId: row.id,
            name: row.name,
            email: row.email,
            role: row.role,
            status: row.is_active ? 'active' : 'inactive',
            approval_status: row.approval_status,
            avatar: row.avatar,
            createdAt: row.created_at,
            updatedAt: row.updated_at,
            lastLoginAt: row.last_login_at,
            is_active: row.is_active,
            created_at: row.created_at,
            updated_at: row.updated_at,
            last_login_at: row.last_login_at,
            password_hash: row.password_hash // –î–æ–±–∞–≤–ª—è–µ–º password_hash –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
        };
    }
    async getUserById(id) {
        const result = await this.query('SELECT * FROM users WHERE id = $1', [
            id
        ]);
        const row = result.rows[0];
        if (!row) return null;
        // –ú–∞–ø–ø–∏–Ω–≥ –ø–æ–ª–µ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –≤ User –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
        return {
            id: row.id,
            userId: row.id,
            name: row.name,
            email: row.email,
            role: row.role,
            status: row.is_active ? 'active' : 'inactive',
            approval_status: row.approval_status,
            avatar: row.avatar,
            createdAt: row.created_at,
            updatedAt: row.updated_at,
            lastLoginAt: row.last_login_at,
            is_active: row.is_active,
            created_at: row.created_at,
            updated_at: row.updated_at,
            last_login_at: row.last_login_at
        };
    }
    async updateUser(id, updates) {
        const fields = Object.keys(updates).filter((key)=>key !== 'id');
        const values = fields.map((field)=>updates[field]);
        const setClause = fields.map((field, index)=>`${field} = $${index + 2}`).join(', ');
        if (fields.length === 0) {
            return await this.getUserById(id);
        }
        const result = await this.query(`UPDATE users SET ${setClause} WHERE id = $1 RETURNING *`, [
            id,
            ...values
        ]);
        return result.rows[0] || null;
    }
    async getAllUsers() {
        const result = await this.query('SELECT * FROM users ORDER BY created_at DESC');
        return result.rows;
    }
    async deleteUser(id) {
        const result = await this.query('DELETE FROM users WHERE id = $1', [
            id
        ]);
        return result.rowCount > 0;
    }
    // === –ú–ï–¢–û–î–´ –î–õ–Ø –ü–†–û–ï–ö–¢–û–í ===
    async createProject(name, description, ownerId, color) {
        const result = await this.query(`INSERT INTO projects (name, description, creator_id, color)
     VALUES ($1, $2, $3, $4) RETURNING *`, [
            name,
            description,
            ownerId,
            color || '#3B82F6'
        ]);
        return result.rows[0];
    }
    async getProjectById(id) {
        const result = await this.query('SELECT * FROM projects WHERE id = $1 AND deleted_at IS NULL', [
            id
        ]);
        return result.rows[0] || null;
    }
    async getProjectsByUserId(userId) {
        const result = await this.query(`SELECT DISTINCT p.* FROM projects p 
       LEFT JOIN project_members pm ON p.id = pm.project_id 
       WHERE (p.creator_id = $1 OR pm.user_id = $1) AND p.deleted_at IS NULL 
       ORDER BY p.created_at DESC`, [
            userId
        ]);
        return result.rows;
    }
    async getAllProjects() {
        const result = await this.query('SELECT * FROM projects WHERE deleted_at IS NULL ORDER BY created_at DESC');
        return result.rows;
    }
    async updateProject(id, updates) {
        const fields = Object.keys(updates).filter((key)=>key !== 'id');
        const values = fields.map((field)=>updates[field]);
        const setClause = fields.map((field, index)=>`${field} = $${index + 2}`).join(', ');
        if (fields.length === 0) {
            return await this.getProjectById(id);
        }
        const result = await this.query(`UPDATE projects SET ${setClause} WHERE id = $1 RETURNING *`, [
            id,
            ...values
        ]);
        return result.rows[0] || null;
    }
    async deleteProject(id) {
        const result = await this.query('UPDATE projects SET deleted_at = CURRENT_TIMESTAMP WHERE id = $1', [
            id
        ]);
        return result.rowCount > 0;
    }
    async hasProjectAccess(userId, projectId) {
        try {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–ª–∞–¥–µ–ª—å—Ü–µ–º –ø—Ä–æ–µ–∫—Ç–∞
            const ownerResult = await this.query('SELECT creator_id FROM projects WHERE id = $1 AND deleted_at IS NULL', [
                projectId
            ]);
            if (ownerResult.rows.length === 0) {
                return false; // –ü—Ä–æ–µ–∫—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω
            }
            const projectOwner = ownerResult.rows[0].creator_id;
            if (projectOwner === userId) {
                return true; // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —è–≤–ª—è–µ—Ç—Å—è –≤–ª–∞–¥–µ–ª—å—Ü–µ–º
            }
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á–ª–µ–Ω—Å—Ç–≤–æ –≤ –ø—Ä–æ–µ–∫—Ç–µ
            const memberResult = await this.query('SELECT 1 FROM project_members WHERE project_id = $1 AND user_id = $2', [
                projectId,
                userId
            ]);
            return memberResult.rows.length > 0;
        } catch (error) {
            console.error('Error checking project access:', error);
            return false;
        }
    }
    // === –ú–ï–¢–û–î–´ –î–õ–Ø –î–û–°–û–ö ===
    async createBoard(name, description, projectId) {
        const result = await this.query(`INSERT INTO boards (name, project_id) 
       VALUES ($1, $2) 
       RETURNING *`, [
            name,
            projectId
        ]);
        return result.rows[0];
    }
    async getBoardById(id) {
        const result = await this.query('SELECT * FROM boards WHERE id = $1 AND deleted_at IS NULL', [
            id
        ]);
        return result.rows[0] || null;
    }
    async getBoardsByProjectId(projectId) {
        const result = await this.query('SELECT * FROM boards WHERE project_id = $1 AND deleted_at IS NULL ORDER BY position ASC, created_at DESC', [
            projectId
        ]);
        return result.rows;
    }
    async updateBoard(id, updates) {
        const fields = Object.keys(updates).filter((key)=>key !== 'id');
        const values = fields.map((field)=>updates[field]);
        const setClause = fields.map((field, index)=>`${field} = $${index + 2}`).join(', ');
        if (fields.length === 0) {
            return await this.getBoardById(id);
        }
        const result = await this.query(`UPDATE boards SET ${setClause} WHERE id = $1 RETURNING *`, [
            id,
            ...values
        ]);
        return result.rows[0] || null;
    }
    async deleteBoard(id) {
        const result = await this.query('UPDATE boards SET deleted_at = CURRENT_TIMESTAMP WHERE id = $1', [
            id
        ]);
        return result.rowCount > 0;
    }
    // === –ú–ï–¢–û–î–´ –î–õ–Ø –ö–û–õ–û–ù–û–ö ===
    async createColumn(name, boardId, position, color) {
        const result = await this.query(`INSERT INTO columns (title, board_id, position, color) 
       VALUES ($1, $2, $3, $4) 
       RETURNING *`, [
            name,
            boardId,
            position || 0,
            color || '#6B7280'
        ]);
        return result.rows[0];
    }
    async getColumnById(id) {
        const result = await this.query('SELECT * FROM columns WHERE id = $1 AND deleted_at IS NULL', [
            id
        ]);
        return result.rows[0] || null;
    }
    async getColumnsByBoardId(boardId) {
        const result = await this.query('SELECT * FROM columns WHERE board_id = $1 AND deleted_at IS NULL ORDER BY position ASC, created_at DESC', [
            boardId
        ]);
        return result.rows;
    }
    async updateColumn(id, updates) {
        const fields = Object.keys(updates).filter((key)=>key !== 'id');
        const values = fields.map((field)=>updates[field]);
        const setClause = fields.map((field, index)=>`${field} = $${index + 2}`).join(', ');
        if (fields.length === 0) {
            return await this.getColumnById(id);
        }
        const result = await this.query(`UPDATE columns SET ${setClause} WHERE id = $1 RETURNING *`, [
            id,
            ...values
        ]);
        return result.rows[0] || null;
    }
    async deleteColumn(id) {
        const result = await this.query('UPDATE columns SET deleted_at = CURRENT_TIMESTAMP WHERE id = $1', [
            id
        ]);
        return result.rowCount > 0;
    }
    // === –ú–ï–¢–û–î–´ –î–õ–Ø –ó–ê–î–ê–ß ===
    async createTask(taskData) {
        const { title, description, status = 'todo', priority = 'medium', project_id, board_id, column_id, assignee_id, reporter_id, position = 0 } = taskData;
        const result = await this.query(`INSERT INTO tasks (title, description, status, priority, project_id, board_id, column_id, assignee_id, reporter_id, position) 
       VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) 
       RETURNING *`, [
            title,
            description,
            status,
            priority,
            project_id,
            board_id,
            column_id,
            assignee_id,
            reporter_id,
            position
        ]);
        return result.rows[0];
    }
    async getTaskById(id) {
        const result = await this.query('SELECT * FROM tasks WHERE id = $1 AND deleted_at IS NULL', [
            id
        ]);
        return result.rows[0] || null;
    }
    async getTasksByProjectId(projectId) {
        const result = await this.query('SELECT * FROM tasks WHERE project_id = $1 AND deleted_at IS NULL ORDER BY position ASC, created_at DESC', [
            projectId
        ]);
        return result.rows;
    }
    async getTasksByColumnId(columnId) {
        const result = await this.query('SELECT * FROM tasks WHERE column_id = $1 AND deleted_at IS NULL ORDER BY position ASC, created_at DESC', [
            columnId
        ]);
        return result.rows;
    }
    async updateTask(id, updates) {
        const fields = Object.keys(updates).filter((key)=>key !== 'id');
        const values = fields.map((field)=>updates[field]);
        const setClause = fields.map((field, index)=>`${field} = $${index + 2}`).join(', ');
        if (fields.length === 0) {
            return await this.getTaskById(id);
        }
        const result = await this.query(`UPDATE tasks SET ${setClause} WHERE id = $1 RETURNING *`, [
            id,
            ...values
        ]);
        return result.rows[0] || null;
    }
    async deleteTask(id) {
        const result = await this.query('UPDATE tasks SET deleted_at = CURRENT_TIMESTAMP WHERE id = $1', [
            id
        ]);
        return result.rowCount > 0;
    }
    // === –ú–ï–¢–û–î–´ –î–õ–Ø –°–ï–°–°–ò–ô ===
    async createSession(sessionToken, userId, expiresAt) {
        const result = await this.query(`INSERT INTO user_sessions (session_token, user_id, expires_at)
     VALUES ($1, $2, $3)
     RETURNING *`, [
            sessionToken,
            userId,
            expiresAt
        ]);
        const row = result.rows[0];
        return {
            id: row.id,
            userId: row.user_id,
            token: row.session_token,
            expiresAt: new Date(row.expires_at),
            isActive: true,
            userAgent: row.user_agent,
            ipAddress: row.ip_address,
            lastActivityAt: new Date(row.last_activity_at || row.created_at),
            createdAt: new Date(row.created_at),
            updatedAt: new Date(row.updated_at || row.created_at)
        };
    }
    async getSessionByToken(sessionToken) {
        const result = await this.query('SELECT * FROM user_sessions WHERE session_token = $1 AND expires_at > NOW()', [
            sessionToken
        ]);
        if (!result.rows[0]) return null;
        const row = result.rows[0];
        return {
            id: row.id,
            userId: row.user_id,
            token: row.session_token,
            expiresAt: new Date(row.expires_at),
            isActive: true,
            userAgent: row.user_agent,
            ipAddress: row.ip_address,
            lastActivityAt: new Date(row.last_activity_at || row.created_at),
            createdAt: new Date(row.created_at),
            updatedAt: new Date(row.updated_at || row.created_at)
        };
    }
    async deleteSession(sessionToken) {
        const result = await this.query('DELETE FROM user_sessions WHERE session_token = $1', [
            sessionToken
        ]);
        return result.rowCount > 0;
    }
    async deleteExpiredSessions() {
        const result = await this.query('DELETE FROM user_sessions WHERE expires_at <= NOW()');
        return result.rowCount;
    }
    // === –ú–ï–¢–û–î–´ –î–õ–Ø –ö–û–ú–ú–ï–ù–¢–ê–†–ò–ï–í ===
    async createComment(content, taskId, authorId) {
        const result = await this.query(`INSERT INTO comments (content, task_id, author_id) 
       VALUES ($1, $2, $3) 
       RETURNING *`, [
            content,
            taskId,
            authorId
        ]);
        return result.rows[0];
    }
    async getCommentsByTaskId(taskId) {
        const result = await this.query('SELECT * FROM comments WHERE task_id = $1 AND deleted_at IS NULL ORDER BY created_at', [
            taskId
        ]);
        return result.rows;
    }
    async updateComment(id, content) {
        const result = await this.query('UPDATE comments SET content = $2 WHERE id = $1 RETURNING *', [
            id,
            content
        ]);
        return result.rows[0] || null;
    }
    async deleteComment(id) {
        const result = await this.query('UPDATE comments SET deleted_at = CURRENT_TIMESTAMP WHERE id = $1', [
            id
        ]);
        return result.rowCount > 0;
    }
    // === –ú–ï–¢–û–î–´ –î–õ–Ø –¢–ï–ì–û–í ===
    async createTag(name, color, projectId) {
        const result = await this.query(`INSERT INTO tags (name, color, project_id) 
       VALUES ($1, $2, $3) 
       RETURNING *`, [
            name,
            color,
            projectId
        ]);
        return result.rows[0];
    }
    async getTagsByProjectId(projectId) {
        const result = await this.query('SELECT * FROM tags WHERE project_id = $1 ORDER BY name', [
            projectId
        ]);
        return result.rows;
    }
    async addTagToTask(taskId, tagId) {
        try {
            await this.query('INSERT INTO task_tags (task_id, tag_id) VALUES ($1, $2)', [
                taskId,
                tagId
            ]);
            return true;
        } catch (error) {
            return false;
        }
    }
    async removeTagFromTask(taskId, tagId) {
        const result = await this.query('DELETE FROM task_tags WHERE task_id = $1 AND tag_id = $2', [
            taskId,
            tagId
        ]);
        return result.rowCount > 0;
    }
    async getTagsByTaskId(taskId) {
        const result = await this.query(`SELECT t.* FROM tags t 
       JOIN task_tags tt ON t.id = tt.tag_id 
       WHERE tt.task_id = $1`, [
            taskId
        ]);
        return result.rows;
    }
    // –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –º–µ—Ç–æ–¥ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ (Singleton)
    static getInstance() {
        if (!PostgreSQLAdapter.instance) {
            const config = {
                host: process.env.DB_HOST || 'localhost',
                port: parseInt(process.env.DB_PORT || '5432'),
                database: process.env.DB_NAME || 'encore_tasks',
                user: process.env.DB_USER || 'postgres',
                password: process.env.DB_PASSWORD || 'password',
                ssl: process.env.DB_SSL === 'true'
            };
            PostgreSQLAdapter.instance = new PostgreSQLAdapter(config);
        }
        return PostgreSQLAdapter.instance;
    }
}
// –≠–∫—Å–ø–æ—Ä—Ç —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ –∞–¥–∞–ø—Ç–µ—Ä–∞
let dbAdapter = null;
function getPostgreSQLAdapter() {
    if (!dbAdapter) {
        const config = {
            host: process.env.DB_HOST || 'localhost',
            port: parseInt(process.env.DB_PORT || '5432'),
            database: process.env.DB_NAME || 'encore_tasks',
            user: process.env.DB_USER || 'postgres',
            password: process.env.DB_PASSWORD || 'password',
            ssl: process.env.DB_SSL === 'true'
        };
        dbAdapter = new PostgreSQLAdapter(config);
    }
    return dbAdapter;
}
const __TURBOPACK__default__export__ = getPostgreSQLAdapter;
__turbopack_async_result__();
} catch(e) { __turbopack_async_result__(e); } }, false);}),
"[project]/src/lib/database-adapter.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname, a: __turbopack_async_module__ } = __turbopack_context__;
__turbopack_async_module__(async (__turbopack_handle_async_dependencies__, __turbopack_async_result__) => { try {
// =====================================================
// –ê–î–ê–ü–¢–ï–† –î–õ–Ø –†–ê–ë–û–¢–´ –° –ë–ê–ó–ê–ú–ò –î–ê–ù–ù–´–• (–ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô)
// =====================================================
__turbopack_context__.s({
    "DatabaseAdapter": (()=>DatabaseAdapter),
    "dbAdapter": (()=>dbAdapter)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$postgresql$2d$adapter$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/postgresql-adapter.ts [app-route] (ecmascript)");
var __turbopack_async_dependencies__ = __turbopack_handle_async_dependencies__([
    __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$postgresql$2d$adapter$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__
]);
([__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$postgresql$2d$adapter$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__] = __turbopack_async_dependencies__.then ? (await __turbopack_async_dependencies__)() : __turbopack_async_dependencies__);
;
class DatabaseAdapter {
    static instance;
    currentDatabase = 'postgresql';
    isInitialized = false;
    postgresqlAdapter;
    initializationPromise = null;
    constructor(){
        this.postgresqlAdapter = __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$postgresql$2d$adapter$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["PostgreSQLAdapter"].getInstance();
        this.currentDatabase = 'postgresql';
    }
    static getInstance() {
        if (!DatabaseAdapter.instance) {
            DatabaseAdapter.instance = new DatabaseAdapter();
        }
        return DatabaseAdapter.instance;
    }
    /**
   * –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∞–¥–∞–ø—Ç–µ—Ä–∞
   */ async initialize() {
        if (this.isInitialized) {
            return;
        }
        if (this.initializationPromise) {
            return this.initializationPromise;
        }
        this.initializationPromise = this.performInitialization();
        return this.initializationPromise;
    }
    async performInitialization() {
        try {
            await this.postgresqlAdapter.initialize();
            this.isInitialized = true;
            console.log('‚úÖ Database Adapter –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω —Å PostgreSQL');
        } catch (error) {
            console.error('‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Database Adapter:', error);
            this.initializationPromise = null;
            throw error;
        }
    }
    /**
   * –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–µ—Ä–µ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º –æ–ø–µ—Ä–∞—Ü–∏–π
   */ async ensureInitialized() {
        if (!this.isInitialized) {
            await this.initialize();
        }
    }
    /**
   * –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
   */ async getDatabaseStatus() {
        const postgresql = await Promise.resolve(this.postgresqlAdapter.initialize()).then(()=>true).catch(()=>false);
        return {
            postgresql,
            current: this.currentDatabase
        };
    }
    /**
   * –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
   */ getCurrentDatabase() {
        return this.currentDatabase;
    }
    // =====================================================
    // –û–ü–ï–†–ê–¶–ò–ò –° –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø–ú–ò
    // =====================================================
    /**
   * –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   */ async createUser(userData) {
        await this.ensureInitialized();
        return await this.postgresqlAdapter.createUser(userData.email, userData.password, userData.name, userData.role || 'user');
    }
    /**
   * –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ ID
   */ async getUserById(id) {
        await this.ensureInitialized();
        return await this.postgresqlAdapter.getUserById(id);
    }
    /**
   * –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ email
   */ async getUserByEmail(email) {
        await this.ensureInitialized();
        return await this.postgresqlAdapter.getUserByEmail(email);
    }
    /**
   * –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
   */ async getAllUsers() {
        await this.ensureInitialized();
        return await this.postgresqlAdapter.getAllUsers();
    }
    /**
   * –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   */ async updateUser(id, updates) {
        await this.ensureInitialized();
        return await this.postgresqlAdapter.updateUser(id, updates);
    }
    /**
   * –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   */ async deleteUser(id) {
        await this.ensureInitialized();
        return await this.postgresqlAdapter.deleteUser(id);
    }
    // =====================================================
    // –û–ü–ï–†–ê–¶–ò–ò –° –°–ï–°–°–ò–Ø–ú–ò (–ò–°–ü–†–ê–í–õ–ï–ù–û)
    // =====================================================
    /**
   * –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Å—Å–∏–∏
   */ async createSession(sessionData) {
        await this.ensureInitialized();
        console.log('üîê DatabaseAdapter: –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Å—Å–∏–∏ —á–µ—Ä–µ–∑ PostgreSQL –∞–¥–∞–ø—Ç–µ—Ä');
        console.log('üîê SessionData:', {
            token: sessionData.token ? 'present' : 'missing',
            userId: sessionData.userId,
            expiresAt: sessionData.expiresAt
        });
        return await this.postgresqlAdapter.createSession(sessionData.token, sessionData.userId, sessionData.expiresAt);
    }
    /**
   * –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–µ—Å—Å–∏–∏ –ø–æ —Ç–æ–∫–µ–Ω—É
   */ async getSessionByToken(token) {
        await this.ensureInitialized();
        console.log('üîç DatabaseAdapter: –ü–æ–∏—Å–∫ —Å–µ—Å—Å–∏–∏ –ø–æ —Ç–æ–∫–µ–Ω—É —á–µ—Ä–µ–∑ PostgreSQL –∞–¥–∞–ø—Ç–µ—Ä');
        const session = await this.postgresqlAdapter.getSessionByToken(token);
        console.log('üìä DatabaseAdapter: –†–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ–∏—Å–∫–∞ —Å–µ—Å—Å–∏–∏:', session ? '–Ω–∞–π–¥–µ–Ω–∞' : '–Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
        return session;
    }
    /**
   * –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ —Å–µ—Å—Å–∏–∏
   */ async updateSessionActivity(token) {
        await this.ensureInitialized();
        // –î–ª—è PostgreSQL –º–æ–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –ø–æ—Å–ª–µ–¥–Ω–µ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
        return true;
    }
    /**
   * –£–¥–∞–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏–∏
   */ async deleteSession(token) {
        await this.ensureInitialized();
        return await this.postgresqlAdapter.deleteSession(token);
    }
    // =====================================================
    // –û–ü–ï–†–ê–¶–ò–ò –° –ü–†–û–ï–ö–¢–ê–ú–ò
    // =====================================================
    /**
   * –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞
   */ async createProject(projectData) {
        await this.ensureInitialized();
        const { name, description, createdBy, color } = projectData;
        return await this.postgresqlAdapter.createProject(name, description || '', createdBy, color);
    }
    /**
   * –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ –ø–æ ID
   */ async getProjectById(id) {
        await this.ensureInitialized();
        return await this.postgresqlAdapter.getProjectById(id);
    }
    /**
   * –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤
   */ async getAllProjects() {
        await this.ensureInitialized();
        return await this.postgresqlAdapter.getAllProjects();
    }
    /**
   * –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   */ async getUserProjects(userId) {
        await this.ensureInitialized();
        return await this.postgresqlAdapter.getUserProjects(userId);
    }
    /**
   * –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–æ–≤ –ø–æ ID —Å–æ–∑–¥–∞—Ç–µ–ª—è
   */ async getProjectsByCreatorId(creatorId) {
        await this.ensureInitialized();
        return await this.postgresqlAdapter.getUserProjects(creatorId);
    }
    /**
   * –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –ø—Ä–æ–µ–∫—Ç—É
   */ async hasProjectAccess(userId, projectId) {
        await this.ensureInitialized();
        return await this.postgresqlAdapter.hasProjectAccess(userId.toString(), projectId);
    }
    // =====================================================
    // –û–ü–ï–†–ê–¶–ò–ò –° –î–û–°–ö–ê–ú–ò
    // =====================================================
    /**
   * –°–æ–∑–¥–∞–Ω–∏–µ –¥–æ—Å–∫–∏
   */ async createBoard(boardData) {
        await this.ensureInitialized();
        return await this.postgresqlAdapter.createBoard(boardData.name, boardData.description || '', boardData.projectId);
    }
    /**
   * –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–æ—Å–∫–∏ –ø–æ ID
   */ async getBoardById(id) {
        await this.ensureInitialized();
        return await this.postgresqlAdapter.getBoardById(id);
    }
    /**
   * –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–æ—Å–æ–∫ –ø—Ä–æ–µ–∫—Ç–∞
   */ async getProjectBoards(projectId) {
        await this.ensureInitialized();
        return await this.postgresqlAdapter.getProjectBoards(projectId);
    }
    /**
   * –£–¥–∞–ª–µ–Ω–∏–µ –¥–æ—Å–∫–∏
   */ async deleteBoard(id) {
        await this.ensureInitialized();
        return await this.postgresqlAdapter.deleteBoard(id);
    }
    // =====================================================
    // –û–ü–ï–†–ê–¶–ò–ò –° –ö–û–õ–û–ù–ö–ê–ú–ò
    // =====================================================
    /**
   * –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–ª–æ–Ω–æ–∫ –¥–æ—Å–∫–∏
   */ async getBoardColumns(boardId) {
        await this.ensureInitialized();
        return await this.postgresqlAdapter.getBoardColumns(boardId);
    }
    /**
   * –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–ª–æ–Ω–∫–∏
   */ async createColumn(columnData) {
        await this.ensureInitialized();
        return await this.postgresqlAdapter.createColumn(columnData.name, columnData.boardId, columnData.position || 0);
    }
    // =====================================================
    // –û–ü–ï–†–ê–¶–ò–ò –° –ó–ê–î–ê–ß–ê–ú–ò
    // =====================================================
    /**
   * –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏
   */ async createTask(taskData) {
        await this.ensureInitialized();
        return await this.postgresqlAdapter.createTask(taskData.title, taskData.description || '', taskData.columnId, taskData.assignedTo, taskData.priority || 'medium', taskData.position || 0);
    }
    /**
   * –ü–æ–ª—É—á–µ–Ω–∏–µ –∑–∞–¥–∞—á –∫–æ–ª–æ–Ω–∫–∏
   */ async getColumnTasks(columnId) {
        await this.ensureInitialized();
        return await this.postgresqlAdapter.getColumnTasks(columnId);
    }
    /**
   * –£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏
   */ async deleteTask(id) {
        await this.ensureInitialized();
        return await this.postgresqlAdapter.deleteTask(id);
    }
    /**
   * –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Å—ã—Ä–æ–≥–æ SQL –∑–∞–ø—Ä–æ—Å–∞ (–¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è–º–∏)
   */ async query(sql, params) {
        await this.ensureInitialized();
        return await this.postgresqlAdapter.query(sql, params);
    }
}
const dbAdapter = DatabaseAdapter.getInstance();
__turbopack_async_result__();
} catch(e) { __turbopack_async_result__(e); } }, false);}),
"[project]/src/lib/auth.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname, a: __turbopack_async_module__ } = __turbopack_context__;
__turbopack_async_module__(async (__turbopack_handle_async_dependencies__, __turbopack_async_result__) => { try {
__turbopack_context__.s({
    "requireAdmin": (()=>requireAdmin),
    "verifyAuth": (()=>verifyAuth),
    "verifyProjectAccess": (()=>verifyProjectAccess)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$jsonwebtoken$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/jsonwebtoken/index.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$database$2d$adapter$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/database-adapter.ts [app-route] (ecmascript)");
var __turbopack_async_dependencies__ = __turbopack_handle_async_dependencies__([
    __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$database$2d$adapter$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__
]);
([__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$database$2d$adapter$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__] = __turbopack_async_dependencies__.then ? (await __turbopack_async_dependencies__)() : __turbopack_async_dependencies__);
;
;
const databaseAdapter = __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$database$2d$adapter$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["DatabaseAdapter"].getInstance();
async function verifyAuth(request) {
    try {
        // –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ –∏–∑ cookie –∏–ª–∏ –∑–∞–≥–æ–ª–æ–≤–∫–∞ Authorization
        const token = request.cookies.get('auth-token')?.value || request.headers.get('authorization')?.replace('Bearer ', '');
        console.log('Auth token found:', !!token);
        if (!token) {
            console.log('No auth token found in cookies or headers');
            return {
                success: false,
                error: '–¢–æ–∫–µ–Ω –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω'
            };
        }
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ JWT —Ç–æ–∫–µ–Ω–∞
        let decoded;
        try {
            decoded = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$jsonwebtoken$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"].verify(token, process.env.JWT_SECRET || 'your-secret-key');
            console.log('JWT verified successfully for user:', decoded.userId);
        } catch (jwtError) {
            console.log('JWT verification failed:', jwtError);
            return {
                success: false,
                error: '–ù–µ–≤–∞–ª–∏–¥–Ω—ã–π —Ç–æ–∫–µ–Ω'
            };
        }
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∞–¥–∞–ø—Ç–µ—Ä –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Å–µ—Å—Å–∏—è–º–∏
        await databaseAdapter.initialize();
        try {
            // –ò—â–µ–º —Å–µ—Å—Å–∏—é —á–µ—Ä–µ–∑ –∞–¥–∞–ø—Ç–µ—Ä
            const session = await databaseAdapter.getSessionByToken(token);
            console.log('Session found:', !!session);
            console.log('Session object:', session);
            console.log('Session userId:', session?.userId);
            if (!session) {
                console.log('Session not found or expired for token');
                return {
                    success: false,
                    error: '–°–µ—Å—Å–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –∏–ª–∏ –∏—Å—Ç–µ–∫–ª–∞'
                };
            }
            // –ü–æ–ª—É—á–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ –∞–¥–∞–ø—Ç–µ—Ä
            const user = await databaseAdapter.getUserById(session.userId);
            if (!user) {
                return {
                    success: false,
                    error: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω'
                };
            }
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å –æ–¥–æ–±—Ä–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            console.log('User data:', user);
            console.log('User isApproved:', user.isApproved, 'type:', typeof user.isApproved);
            console.log('User role:', user.role);
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º approval_status –¥–ª—è PostgreSQL
            const isApproved = user.isApproved !== undefined ? Boolean(user.isApproved) : true;
            console.log('Final isApproved:', isApproved);
            if (!isApproved && user.role !== 'admin') {
                console.log('User not approved and not admin');
                return {
                    success: false,
                    error: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –æ–¥–æ–±—Ä–µ–Ω'
                };
            }
            return {
                success: true,
                user: {
                    userId: String(user.id),
                    email: user.email,
                    role: user.role,
                    name: user.name
                }
            };
        } catch (error) {
            console.error('Auth error:', error);
            return {
                success: false,
                error: '–û—à–∏–±–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏'
            };
        }
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏:', error);
        return {
            success: false,
            error: '–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞'
        };
    }
}
async function verifyProjectAccess(userId, projectId, requiredRole) {
    try {
        await databaseAdapter.initialize();
        // –ü–æ–ª—É—á–∞–µ–º –ø—Ä–æ–µ–∫—Ç—ã —á–µ—Ä–µ–∑ –∞–¥–∞–ø—Ç–µ—Ä
        const projects = await databaseAdapter.getAllProjects();
        const project = projects.find((p)=>p.id === projectId);
        if (!project) {
            return {
                hasAccess: false
            };
        }
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–ª–∞–¥–µ–ª—å—Ü–µ–º
        if (project.createdBy === userId) {
            return {
                hasAccess: true,
                userRole: 'owner'
            };
        }
        // –ü–æ–ª—É—á–∞–µ–º —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞ —á–µ—Ä–µ–∑ getUserProjects
        const userProjects = await databaseAdapter.getUserProjects(userId);
        const hasAccess = userProjects.some((p)=>p.id === projectId);
        if (!hasAccess) {
            return {
                hasAccess: false
            };
        }
        // –î–ª—è —É–ø—Ä–æ—â–µ–Ω–∏—è, —Å—á–∏—Ç–∞–µ–º —á—Ç–æ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –µ—Å—Ç—å –¥–æ—Å—Ç—É–ø –∫–∞–∫ —É—á–∞—Å—Ç–Ω–∏–∫
        const userRole = 'member';
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç—Ä–µ–±—É–µ–º–æ–π —Ä–æ–ª–∏
        if (requiredRole) {
            const roleHierarchy = {
                owner: 3,
                admin: 2,
                member: 1
            };
            const userRoleLevel = roleHierarchy[userRole] || 0;
            const requiredRoleLevel = roleHierarchy[requiredRole];
            if (userRoleLevel < requiredRoleLevel) {
                return {
                    hasAccess: false,
                    userRole
                };
            }
        }
        return {
            hasAccess: true,
            userRole
        };
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–∞ –∫ –ø—Ä–æ–µ–∫—Ç—É:', error);
        return {
            hasAccess: false
        };
    }
}
async function requireAdmin(request) {
    const authResult = await verifyAuth(request);
    if (!authResult.success) {
        return {
            success: false,
            error: authResult.error
        };
    }
    if (authResult.user.role !== 'admin') {
        return {
            success: false,
            error: '–¢—Ä–µ–±—É—é—Ç—Å—è –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞'
        };
    }
    return {
        success: true,
        user: authResult.user
    };
}
__turbopack_async_result__();
} catch(e) { __turbopack_async_result__(e); } }, false);}),
"[project]/src/services/implementations/board.service.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname } = __turbopack_context__;
{
/**
 * –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å–µ—Ä–≤–∏—Å–∞ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–æ—Å–∫–∞–º–∏
 * –°–ª–µ–¥—É–µ—Ç –ø—Ä–∏–Ω—Ü–∏–ø–∞–º SOLID –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Dependency Injection
 */ __turbopack_context__.s({
    "BoardService": (()=>BoardService)
});
class BoardService {
    boardRepository;
    boardValidator;
    permissionService;
    eventService;
    cacheService;
    constructor(boardRepository, boardValidator, permissionService, eventService, cacheService){
        this.boardRepository = boardRepository;
        this.boardValidator = boardValidator;
        this.permissionService = permissionService;
        this.eventService = eventService;
        this.cacheService = cacheService;
    }
    async getBoardById(id, userId) {
        try {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
            const canView = await this.permissionService.canUserViewBoard(id, userId);
            if (!canView) {
                return {
                    success: false,
                    error: 'Access denied: You do not have permission to view this board'
                };
            }
            // –ü—ã—Ç–∞–µ–º—Å—è –ø–æ–ª—É—á–∏—Ç—å –∏–∑ –∫—ç—à–∞
            let board = null;
            if (this.cacheService) {
                board = await this.cacheService.getBoard(id);
            }
            // –ï—Å–ª–∏ –Ω–µ –≤ –∫—ç—à–µ, –ø–æ–ª—É—á–∞–µ–º –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
            if (!board) {
                board = await this.boardRepository.findById(id);
                if (board && this.cacheService) {
                    await this.cacheService.setBoard(board);
                }
            }
            if (!board) {
                return {
                    success: false,
                    error: 'Board not found'
                };
            }
            return {
                success: true,
                data: board
            };
        } catch (error) {
            return {
                success: false,
                error: `Failed to get board: ${error instanceof Error ? error.message : 'Unknown error'}`
            };
        }
    }
    async getBoardsByProject(projectId, userId, filters) {
        try {
            // –ü—ã—Ç–∞–µ–º—Å—è –ø–æ–ª—É—á–∏—Ç—å –∏–∑ –∫—ç—à–∞
            let boards = null;
            if (this.cacheService && !filters) {
                boards = await this.cacheService.getBoardsByProject(projectId);
            }
            // –ï—Å–ª–∏ –Ω–µ –≤ –∫—ç—à–µ, –ø–æ–ª—É—á–∞–µ–º –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
            if (!boards) {
                boards = await this.boardRepository.findByProjectId(projectId, filters);
                if (this.cacheService && !filters) {
                    await this.cacheService.setBoardsByProject(projectId, boards);
                }
            }
            // –§–∏–ª—å—Ç—Ä—É–µ–º –¥–æ—Å–∫–∏ –ø–æ –ø—Ä–∞–≤–∞–º –¥–æ—Å—Ç—É–ø–∞
            const accessibleBoards = [];
            for (const board of boards){
                const canView = await this.permissionService.canUserViewBoard(board.id, userId);
                if (canView) {
                    accessibleBoards.push(board);
                }
            }
            return {
                success: true,
                data: accessibleBoards
            };
        } catch (error) {
            return {
                success: false,
                error: `Failed to get boards: ${error instanceof Error ? error.message : 'Unknown error'}`
            };
        }
    }
    async getAllBoards(userId, filters, sort, pagination) {
        try {
            const result = await this.boardRepository.findAll(filters, sort, pagination);
            // –§–∏–ª—å—Ç—Ä—É–µ–º –¥–æ—Å–∫–∏ –ø–æ –ø—Ä–∞–≤–∞–º –¥–æ—Å—Ç—É–ø–∞
            const accessibleBoards = [];
            for (const board of result.data){
                const canView = await this.permissionService.canUserViewBoard(board.id, userId);
                if (canView) {
                    accessibleBoards.push(board);
                }
            }
            return {
                success: true,
                data: {
                    ...result,
                    data: accessibleBoards,
                    pagination: {
                        ...result.pagination,
                        total: accessibleBoards.length
                    }
                }
            };
        } catch (error) {
            return {
                success: false,
                error: `Failed to get all boards: ${error instanceof Error ? error.message : 'Unknown error'}`
            };
        }
    }
    async createBoard(boardData, userId) {
        try {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∞–≤–∞ –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ –¥–æ—Å–∫–∏
            const canCreate = await this.permissionService.canUserCreateBoard(boardData.projectId, userId);
            if (!canCreate) {
                return {
                    success: false,
                    error: 'Access denied: You do not have permission to create boards in this project'
                };
            }
            // –í–∞–ª–∏–¥–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ
            const validationResult = await this.boardValidator.validateCreateData(boardData);
            if (!validationResult.success) {
                return validationResult;
            }
            // –°–æ–∑–¥–∞–µ–º –¥–æ—Å–∫—É
            const board = await this.boardRepository.create({
                ...boardData,
                createdBy: userId
            });
            // –ò–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ–º –∫—ç—à –ø—Ä–æ–µ–∫—Ç–∞
            if (this.cacheService) {
                await this.cacheService.invalidateProjectBoards(boardData.projectId);
            }
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–±—ã—Ç–∏–µ
            await this.eventService.emitBoardCreated(board, userId);
            return {
                success: true,
                data: board
            };
        } catch (error) {
            return {
                success: false,
                error: `Failed to create board: ${error instanceof Error ? error.message : 'Unknown error'}`
            };
        }
    }
    async updateBoard(id, boardData, userId) {
        try {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∞–≤–∞ –Ω–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
            const canEdit = await this.permissionService.canUserEditBoard(id, userId);
            if (!canEdit) {
                return {
                    success: false,
                    error: 'Access denied: You do not have permission to edit this board'
                };
            }
            // –ü–æ–ª—É—á–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –¥–æ—Å–∫—É
            const existingBoard = await this.boardRepository.findById(id);
            if (!existingBoard) {
                return {
                    success: false,
                    error: 'Board not found'
                };
            }
            // –í–∞–ª–∏–¥–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ
            const validationResult = await this.boardValidator.validateUpdateData(boardData, existingBoard);
            if (!validationResult.success) {
                return validationResult;
            }
            // –û–±–Ω–æ–≤–ª—è–µ–º –¥–æ—Å–∫—É
            const updatedBoard = await this.boardRepository.update(id, boardData, userId);
            if (!updatedBoard) {
                return {
                    success: false,
                    error: 'Failed to update board'
                };
            }
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫—ç—à
            if (this.cacheService) {
                await this.cacheService.setBoard(updatedBoard);
                await this.cacheService.invalidateProjectBoards(updatedBoard.projectId);
            }
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–±—ã—Ç–∏–µ
            await this.eventService.emitBoardUpdated(updatedBoard, userId, boardData);
            return {
                success: true,
                data: updatedBoard
            };
        } catch (error) {
            return {
                success: false,
                error: `Failed to update board: ${error instanceof Error ? error.message : 'Unknown error'}`
            };
        }
    }
    async deleteBoard(id, userId) {
        try {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∞–≤–∞ –Ω–∞ —É–¥–∞–ª–µ–Ω–∏–µ
            const canDelete = await this.permissionService.canUserDeleteBoard(id, userId);
            if (!canDelete) {
                return {
                    success: false,
                    error: 'Access denied: You do not have permission to delete this board'
                };
            }
            // –ü–æ–ª—É—á–∞–µ–º –¥–æ—Å–∫—É –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è projectId
            const board = await this.boardRepository.findById(id);
            if (!board) {
                return {
                    success: false,
                    error: 'Board not found'
                };
            }
            // –£–¥–∞–ª—è–µ–º –¥–æ—Å–∫—É
            const deleted = await this.boardRepository.delete(id);
            if (!deleted) {
                return {
                    success: false,
                    error: 'Failed to delete board'
                };
            }
            // –û—á–∏—â–∞–µ–º –∫—ç—à
            if (this.cacheService) {
                await this.cacheService.deleteBoard(id);
                await this.cacheService.invalidateProjectBoards(board.projectId);
            }
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–±—ã—Ç–∏–µ
            await this.eventService.emitBoardDeleted(id, userId);
            return {
                success: true,
                data: true
            };
        } catch (error) {
            return {
                success: false,
                error: `Failed to delete board: ${error instanceof Error ? error.message : 'Unknown error'}`
            };
        }
    }
    async archiveBoard(id, userId) {
        try {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∞–≤–∞ –Ω–∞ –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–µ
            const canEdit = await this.permissionService.canUserEditBoard(id, userId);
            if (!canEdit) {
                return {
                    success: false,
                    error: 'Access denied: You do not have permission to archive this board'
                };
            }
            // –ü–æ–ª—É—á–∞–µ–º –¥–æ—Å–∫—É –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è projectId
            const board = await this.boardRepository.findById(id);
            if (!board) {
                return {
                    success: false,
                    error: 'Board not found'
                };
            }
            // –ê—Ä—Ö–∏–≤–∏—Ä—É–µ–º –¥–æ—Å–∫—É
            const archived = await this.boardRepository.archive(id, userId);
            if (!archived) {
                return {
                    success: false,
                    error: 'Failed to archive board'
                };
            }
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫—ç—à
            if (this.cacheService) {
                await this.cacheService.deleteBoard(id);
                await this.cacheService.invalidateProjectBoards(board.projectId);
            }
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–±—ã—Ç–∏–µ
            await this.eventService.emitBoardArchived(id, userId);
            return {
                success: true,
                data: true
            };
        } catch (error) {
            return {
                success: false,
                error: `Failed to archive board: ${error instanceof Error ? error.message : 'Unknown error'}`
            };
        }
    }
    async restoreBoard(id, userId) {
        try {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∞–≤–∞ –Ω–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
            const canEdit = await this.permissionService.canUserEditBoard(id, userId);
            if (!canEdit) {
                return {
                    success: false,
                    error: 'Access denied: You do not have permission to restore this board'
                };
            }
            // –ü–æ–ª—É—á–∞–µ–º –¥–æ—Å–∫—É –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è projectId
            const board = await this.boardRepository.findById(id);
            if (!board) {
                return {
                    success: false,
                    error: 'Board not found'
                };
            }
            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –¥–æ—Å–∫—É
            const restored = await this.boardRepository.restore(id, userId);
            if (!restored) {
                return {
                    success: false,
                    error: 'Failed to restore board'
                };
            }
            // –ò–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ–º –∫—ç—à
            if (this.cacheService) {
                await this.cacheService.invalidateProjectBoards(board.projectId);
            }
            return {
                success: true,
                data: true
            };
        } catch (error) {
            return {
                success: false,
                error: `Failed to restore board: ${error instanceof Error ? error.message : 'Unknown error'}`
            };
        }
    }
    async reorderBoards(projectId, boardIds, userId) {
        try {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∞–≤–∞ –Ω–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ—Å–æ–∫ –≤ –ø—Ä–æ–µ–∫—Ç–µ
            const canCreate = await this.permissionService.canUserCreateBoard(projectId, userId);
            if (!canCreate) {
                return {
                    success: false,
                    error: 'Access denied: You do not have permission to reorder boards in this project'
                };
            }
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏–∏ –¥–æ—Å–æ–∫
            const updates = boardIds.map((boardId, index)=>({
                    id: boardId,
                    position: index + 1
                }));
            for (const update of updates){
                await this.boardRepository.updatePosition(update.id, update.position);
            }
            // –ò–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ–º –∫—ç—à
            if (this.cacheService) {
                await this.cacheService.invalidateProjectBoards(projectId);
            }
            return {
                success: true,
                data: true
            };
        } catch (error) {
            return {
                success: false,
                error: `Failed to reorder boards: ${error instanceof Error ? error.message : 'Unknown error'}`
            };
        }
    }
    async duplicateBoard(id, newName, userId) {
        try {
            // –ü–æ–ª—É—á–∞–µ–º –∏—Å—Ö–æ–¥–Ω—É—é –¥–æ—Å–∫—É
            const originalBoard = await this.boardRepository.findById(id);
            if (!originalBoard) {
                return {
                    success: false,
                    error: 'Original board not found'
                };
            }
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∞–≤–∞ –Ω–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä –∏—Å—Ö–æ–¥–Ω–æ–π –¥–æ—Å–∫–∏
            const canView = await this.permissionService.canUserViewBoard(id, userId);
            if (!canView) {
                return {
                    success: false,
                    error: 'Access denied: You do not have permission to view the original board'
                };
            }
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∞–≤–∞ –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ –¥–æ—Å–∫–∏ –≤ –ø—Ä–æ–µ–∫—Ç–µ
            const canCreate = await this.permissionService.canUserCreateBoard(originalBoard.projectId, userId);
            if (!canCreate) {
                return {
                    success: false,
                    error: 'Access denied: You do not have permission to create boards in this project'
                };
            }
            // –°–æ–∑–¥–∞–µ–º –¥—É–±–ª–∏–∫–∞—Ç
            const duplicateData = {
                name: newName,
                description: originalBoard.description,
                projectId: originalBoard.projectId,
                visibility: originalBoard.visibility,
                settings: originalBoard.settings,
                icon: originalBoard.icon,
                color: originalBoard.color
            };
            return await this.createBoard(duplicateData, userId);
        } catch (error) {
            return {
                success: false,
                error: `Failed to duplicate board: ${error instanceof Error ? error.message : 'Unknown error'}`
            };
        }
    }
    async getBoardStatistics(id, userId) {
        try {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
            const canView = await this.permissionService.canUserViewBoard(id, userId);
            if (!canView) {
                return {
                    success: false,
                    error: 'Access denied: You do not have permission to view this board'
                };
            }
            // –ó–¥–µ—Å—å –±—É–¥–µ—Ç –ª–æ–≥–∏–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
            // –ü–æ–∫–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∑–∞–≥–ª—É—à–∫—É
            const statistics = {
                totalTasks: 0,
                completedTasks: 0,
                inProgressTasks: 0,
                todoTasks: 0,
                totalColumns: 0
            };
            return {
                success: true,
                data: statistics
            };
        } catch (error) {
            return {
                success: false,
                error: `Failed to get board statistics: ${error instanceof Error ? error.message : 'Unknown error'}`
            };
        }
    }
    async getUserPermissions(boardId, userId) {
        try {
            const permissions = await this.permissionService.getUserPermissions(boardId, userId);
            return {
                success: true,
                data: permissions
            };
        } catch (error) {
            return {
                success: false,
                error: `Failed to get user permissions: ${error instanceof Error ? error.message : 'Unknown error'}`
            };
        }
    }
    async getBoardEvents(boardId, userId, limit) {
        try {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
            const canView = await this.permissionService.canUserViewBoard(boardId, userId);
            if (!canView) {
                return {
                    success: false,
                    error: 'Access denied: You do not have permission to view this board'
                };
            }
            const events = await this.eventService.getBoardEvents(boardId, limit);
            return {
                success: true,
                data: events
            };
        } catch (error) {
            return {
                success: false,
                error: `Failed to get board events: ${error instanceof Error ? error.message : 'Unknown error'}`
            };
        }
    }
}
}}),
"[project]/src/services/implementations/board.repository.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname } = __turbopack_context__;
{
/**
 * –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –¥–ª—è –¥–æ—Å–æ–∫
 * –û—Ç–≤–µ—á–∞–µ—Ç —Ç–æ–ª—å–∫–æ –∑–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –¥–∞–Ω–Ω—ã–º–∏ (Single Responsibility)
 */ __turbopack_context__.s({
    "BoardRepository": (()=>BoardRepository)
});
class BoardRepository {
    databaseAdapter;
    constructor(databaseAdapter){
        this.databaseAdapter = databaseAdapter;
    }
    async findById(id) {
        try {
            const query = `
        SELECT 
          id,
          name,
          project_id as projectId,
          visibility,
          settings,
          icon,
          color,
          is_default,
          created_by as createdBy,
          created_at as createdAt,
          updated_at as updatedAt
        FROM boards 
        WHERE id = ?
      `;
            const result = await this.databaseAdapter.query(query, [
                id
            ]);
            if (!result || result.length === 0) {
                return null;
            }
            return this.mapRowToBoard(result[0]);
        } catch (error) {
            console.error('Error finding board by id:', error);
            throw new Error(`Failed to find board: ${error instanceof Error ? error.message : 'Unknown error'}`);
        }
    }
    async findByProjectId(projectId, filters) {
        try {
            let query = `
        SELECT 
          id,
          name,
          project_id as projectId,
          visibility,
          settings,
          icon,
          color,
          is_default,
          created_by as createdBy,
          created_at as createdAt,
          updated_at as updatedAt
        FROM boards 
        WHERE project_id = ?
      `;
            const params = [
                projectId
            ];
            // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ñ–∏–ª—å—Ç—Ä—ã
            if (filters) {
                if (filters.visibility) {
                    query += ` AND visibility = ?`;
                    params.push(filters.visibility);
                }
                if (filters.createdBy) {
                    query += ` AND created_by = ?`;
                    params.push(filters.createdBy);
                }
                // –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤ —Ç–µ–∫—É—â–µ–π —Å—Ö–µ–º–µ PostgreSQL
                if (filters.search) {
                    query += ` AND name LIKE ?`;
                    const searchTerm = `%${filters.search}%`;
                    params.push(searchTerm);
                }
            }
            query += ' ORDER BY position ASC, created_at DESC';
            const results = await this.databaseAdapter.query(query, params);
            return results.map((row)=>this.mapRowToBoard(row));
        } catch (error) {
            console.error('Error finding boards by project:', error);
            throw new Error(`Failed to find boards: ${error instanceof Error ? error.message : 'Unknown error'}`);
        }
    }
    async findAll(filters, sort, pagination) {
        try {
            let query = `
        SELECT 
          id,
          name,
          description,
          project_id as projectId,
          visibility,
          settings,
          icon,
          color,
          position,
          created_by as createdBy,
          updated_by as updatedBy,
          created_at as createdAt,
          updated_at as updatedAt,
          is_archived as isArchived,
          archived_at as archivedAt
        FROM boards 
        WHERE 1=1
      `;
            const params = [];
            let paramIndex = 1;
            // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ñ–∏–ª—å—Ç—Ä—ã
            if (filters) {
                if (filters.projectId) {
                    query += ` AND project_id = $${paramIndex++}`;
                    params.push(filters.projectId);
                }
                if (filters.visibility) {
                    query += ` AND visibility = $${paramIndex++}`;
                    params.push(filters.visibility);
                }
                if (filters.createdBy) {
                    query += ` AND created_by = $${paramIndex++}`;
                    params.push(filters.createdBy);
                }
                // –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤ —Ç–µ–∫—É—â–µ–π —Å—Ö–µ–º–µ PostgreSQL
                if (filters.search) {
                    query += ` AND name LIKE $${paramIndex++}`;
                    const searchTerm = `%${filters.search}%`;
                    params.push(searchTerm);
                }
            }
            // –ü—Ä–∏–º–µ–Ω—è–µ–º —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É
            if (sort) {
                const sortField = this.mapSortField(sort.field);
                query += ` ORDER BY ${sortField} ${sort.direction.toUpperCase()}`;
            } else {
                query += ' ORDER BY created_at DESC';
            }
            // –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ–º –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
            const countQuery = query.replace(/SELECT[\s\S]*?FROM/, 'SELECT COUNT(*) as total FROM');
            const countResult = await this.databaseAdapter.query(countQuery, params);
            const total = countResult[0]?.total || 0;
            // –ü—Ä–∏–º–µ–Ω—è–µ–º –ø–∞–≥–∏–Ω–∞—Ü–∏—é
            if (pagination) {
                const offset = (pagination.page - 1) * pagination.limit;
                query += ` LIMIT $${paramIndex++} OFFSET $${paramIndex++}`;
                params.push(pagination.limit, offset);
            }
            const results = await this.databaseAdapter.query(query, params);
            const boards = results.map((row)=>this.mapRowToBoard(row));
            const totalPages = pagination ? Math.ceil(total / pagination.limit) : 1;
            const currentPage = pagination?.page || 1;
            return {
                data: boards,
                pagination: {
                    page: currentPage,
                    limit: pagination?.limit || total,
                    total,
                    totalPages,
                    hasNext: currentPage < totalPages,
                    hasPrev: currentPage > 1
                }
            };
        } catch (error) {
            console.error('Error finding all boards:', error);
            throw new Error(`Failed to find boards: ${error instanceof Error ? error.message : 'Unknown error'}`);
        }
    }
    async create(boardData) {
        try {
            const id = this.generateId();
            const now = new Date();
            const defaultSettings = {
                allowTaskCreation: true,
                allowColumnReordering: true,
                enableTaskLimits: false,
                defaultTaskPriority: 'medium',
                autoArchiveCompletedTasks: false,
                ...boardData.settings
            };
            const query = `
        INSERT INTO boards (
          id, name, project_id, visibility, settings, 
          icon, color, created_by, created_at, updated_at
        ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
      `;
            const params = [
                id,
                boardData.name,
                boardData.projectId,
                boardData.visibility || 'team',
                JSON.stringify(defaultSettings),
                boardData.icon || null,
                boardData.color || '#3B82F6',
                boardData.createdBy,
                now.toISOString(),
                now.toISOString()
            ];
            await this.databaseAdapter.query(query, params);
            // –°–æ–∑–¥–∞–µ–º –∫–æ–ª–æ–Ω–∫–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            await this.createDefaultColumns(id, boardData.createdBy);
            const createdBoard = await this.findById(id);
            if (!createdBoard) {
                throw new Error('Failed to retrieve created board');
            }
            return createdBoard;
        } catch (error) {
            console.error('Error creating board:', error);
            throw new Error(`Failed to create board: ${error instanceof Error ? error.message : 'Unknown error'}`);
        }
    }
    async update(id, boardData, updatedBy) {
        try {
            const updateFields = [];
            const params = [];
            let paramIndex = 1;
            if (boardData.name !== undefined) {
                updateFields.push(`name = $${paramIndex++}`);
                params.push(boardData.name);
            }
            if (boardData.visibility !== undefined) {
                updateFields.push(`visibility = $${paramIndex++}`);
                params.push(boardData.visibility);
            }
            if (boardData.settings !== undefined) {
                // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏ –æ–±—ä–µ–¥–∏–Ω—è–µ–º —Å –Ω–æ–≤—ã–º–∏
                const currentBoard = await this.findById(id);
                if (currentBoard) {
                    const updatedSettings = {
                        ...currentBoard.settings,
                        ...boardData.settings
                    };
                    updateFields.push(`settings = $${paramIndex++}`);
                    params.push(JSON.stringify(updatedSettings));
                }
            }
            if (boardData.icon !== undefined) {
                updateFields.push(`icon = $${paramIndex++}`);
                params.push(boardData.icon);
            }
            if (boardData.color !== undefined) {
                updateFields.push(`color = $${paramIndex++}`);
                params.push(boardData.color);
            }
            if (updateFields.length === 0) {
                return await this.findById(id);
            }
            updateFields.push(`updated_at = $${paramIndex++}`);
            params.push(new Date().toISOString());
            params.push(id);
            const query = `UPDATE boards SET ${updateFields.join(', ')} WHERE id = $${paramIndex}`;
            await this.databaseAdapter.query(query, params);
            return await this.findById(id);
        } catch (error) {
            console.error('Error updating board:', error);
            throw new Error(`Failed to update board: ${error instanceof Error ? error.message : 'Unknown error'}`);
        }
    }
    async delete(id) {
        try {
            // –°–Ω–∞—á–∞–ª–∞ —É–¥–∞–ª—è–µ–º –≤—Å–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–∑–∞–¥–∞—á–∏, –∫–æ–ª–æ–Ω–∫–∏)
            await this.databaseAdapter.query('DELETE FROM tasks WHERE board_id = ?', [
                id
            ]);
            await this.databaseAdapter.query('DELETE FROM columns WHERE board_id = ?', [
                id
            ]);
            // –ó–∞—Ç–µ–º —É–¥–∞–ª—è–µ–º —Å–∞–º—É –¥–æ—Å–∫—É
            const query = 'DELETE FROM boards WHERE id = ?';
            const result = await this.databaseAdapter.query(query, [
                id
            ]);
            return result.affectedRows > 0;
        } catch (error) {
            console.error('Error deleting board:', error);
            throw new Error(`Failed to delete board: ${error instanceof Error ? error.message : 'Unknown error'}`);
        }
    }
    async archive(id, archivedBy) {
        try {
            // –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤ —Ç–µ–∫—É—â–µ–π —Å—Ö–µ–º–µ PostgreSQL
            // –í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ –ø—Ä–æ—Å—Ç–æ —É–¥–∞–ª—è–µ–º –¥–æ—Å–∫—É
            return await this.delete(id);
        } catch (error) {
            console.error('Error archiving board:', error);
            throw new Error(`Failed to archive board: ${error instanceof Error ? error.message : 'Unknown error'}`);
        }
    }
    async restore(id, restoredBy) {
        try {
            // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤ —Ç–µ–∫—É—â–µ–π —Å—Ö–µ–º–µ PostgreSQL
            return false;
        } catch (error) {
            console.error('Error restoring board:', error);
            throw new Error(`Failed to restore board: ${error instanceof Error ? error.message : 'Unknown error'}`);
        }
    }
    async updatePosition(id, newPosition) {
        try {
            // –ü–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤ —Ç–µ–∫—É—â–µ–π —Å—Ö–µ–º–µ PostgreSQL
            return true;
        } catch (error) {
            console.error('Error updating board position:', error);
            throw new Error(`Failed to update board position: ${error instanceof Error ? error.message : 'Unknown error'}`);
        }
    }
    async getMaxPosition(projectId) {
        try {
            // –ü–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤ —Ç–µ–∫—É—â–µ–π —Å—Ö–µ–º–µ PostgreSQL
            return 0;
        } catch (error) {
            console.error('Error getting max position:', error);
            return 0;
        }
    }
    async existsByName(name, projectId, excludeId) {
        try {
            let query = 'SELECT COUNT(*) as count FROM boards WHERE name = ? AND project_id = ?';
            const params = [
                name,
                projectId
            ];
            if (excludeId) {
                query += ' AND id != ?';
                params.push(excludeId);
            }
            const result = await this.databaseAdapter.query(query, params);
            return result[0]?.count > 0;
        } catch (error) {
            console.error('Error checking board name existence:', error);
            return false;
        }
    }
    async countByProject(projectId) {
        try {
            const query = 'SELECT COUNT(*) as count FROM boards WHERE project_id = ?';
            const result = await this.databaseAdapter.query(query, [
                projectId
            ]);
            return result[0]?.count || 0;
        } catch (error) {
            console.error('Error counting boards by project:', error);
            return 0;
        }
    }
    async createDefaultColumns(boardId, createdBy) {
        const defaultColumns = [
            {
                title: 'To Do',
                color: '#EF4444',
                position: 1
            },
            {
                title: 'In Progress',
                color: '#F59E0B',
                position: 2
            },
            {
                title: 'Review',
                color: '#3B82F6',
                position: 3
            },
            {
                title: 'Done',
                color: '#10B981',
                position: 4
            }
        ];
        const now = new Date();
        for (const column of defaultColumns){
            const columnId = this.generateId();
            const query = `
        INSERT INTO columns (
          id, name, board_id, position, color, settings, 
          created_at, updated_at
        ) VALUES (?, ?, ?, ?, ?, ?, ?, ?)
      `;
            const defaultColumnSettings = {
                allowTaskCreation: true,
                autoMoveRules: []
            };
            await this.databaseAdapter.query(query, [
                columnId,
                column.title,
                boardId,
                column.position,
                column.color,
                JSON.stringify(defaultColumnSettings),
                now.toISOString(),
                now.toISOString()
            ]);
        }
    }
    mapRowToBoard(row) {
        return {
            id: row.id,
            name: row.name,
            description: row.description,
            projectId: row.projectId,
            visibility: row.visibility,
            settings: typeof row.settings === 'string' ? JSON.parse(row.settings) : row.settings,
            icon: row.icon,
            color: row.color,
            position: row.position,
            createdBy: row.createdBy,
            updatedBy: row.updatedBy,
            createdAt: new Date(row.createdAt),
            updatedAt: new Date(row.updatedAt),
            isArchived: Boolean(row.isArchived),
            archivedAt: row.archivedAt ? new Date(row.archivedAt) : undefined
        };
    }
    mapSortField(field) {
        const fieldMap = {
            'createdAt': 'created_at',
            'updatedAt': 'updated_at',
            'priority': 'position',
            'deadline': 'created_at',
            'position': 'position',
            'title': 'name'
        };
        return fieldMap[field] || 'created_at';
    }
    generateId() {
        // Import crypto for UUID generation
        const crypto = __turbopack_context__.r("[externals]/crypto [external] (crypto, cjs)");
        return crypto.randomUUID();
    }
}
}}),
"[project]/src/services/implementations/board.validator.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname } = __turbopack_context__;
{
/**
 * –í–∞–ª–∏–¥–∞—Ç–æ—Ä –¥–ª—è –¥–æ—Å–æ–∫
 * –û—Ç–≤–µ—á–∞–µ—Ç —Ç–æ–ª—å–∫–æ –∑–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö (Single Responsibility)
 */ __turbopack_context__.s({
    "BoardValidator": (()=>BoardValidator)
});
class BoardValidator {
    async validateCreate(data) {
        const errors = [];
        // –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞–∑–≤–∞–Ω–∏—è
        const nameValidation = this.validateName(data.name);
        if (!nameValidation.isValid) {
            errors.push(...nameValidation.errors);
        }
        // –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞
        const projectValidation = this.validateProjectId(data.projectId);
        if (!projectValidation.isValid) {
            errors.push(...projectValidation.errors);
        }
        // –í–∞–ª–∏–¥–∞—Ü–∏—è –æ–ø–∏—Å–∞–Ω–∏—è
        if (data.description !== undefined) {
            const descriptionValidation = this.validateDescription(data.description);
            if (!descriptionValidation.isValid) {
                errors.push(...descriptionValidation.errors);
            }
        }
        // –í–∞–ª–∏–¥–∞—Ü–∏—è –≤–∏–¥–∏–º–æ—Å—Ç–∏
        if (data.visibility !== undefined) {
            const visibilityValidation = this.validateVisibility(data.visibility);
            if (!visibilityValidation.isValid) {
                errors.push(...visibilityValidation.errors);
            }
        }
        // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ü–≤–µ—Ç–∞
        if (data.color !== undefined) {
            const colorValidation = this.validateColor(data.color);
            if (!colorValidation.isValid) {
                errors.push(...colorValidation.errors);
            }
        }
        // –í–∞–ª–∏–¥–∞—Ü–∏—è –∏–∫–æ–Ω–∫–∏
        if (data.icon !== undefined) {
            const iconValidation = this.validateIcon(data.icon);
            if (!iconValidation.isValid) {
                errors.push(...iconValidation.errors);
            }
        }
        // –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫
        if (data.settings !== undefined) {
            const settingsValidation = this.validateSettings(data.settings);
            if (!settingsValidation.isValid) {
                errors.push(...settingsValidation.errors);
            }
        }
        return {
            isValid: errors.length === 0,
            errors
        };
    }
    async validateCreateData(data) {
        const validationResult = await this.validateCreate(data);
        if (validationResult.isValid) {
            return {
                success: true
            };
        }
        const errorMessages = validationResult.errors.map((error)=>error.message).join(', ');
        return {
            success: false,
            error: errorMessages
        };
    }
    async validateUpdate(id, data) {
        const errors = [];
        // –í–∞–ª–∏–¥–∞—Ü–∏—è ID
        const idValidation = this.validateId(id);
        if (!idValidation.isValid) {
            errors.push(...idValidation.errors);
        }
        // –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞–∑–≤–∞–Ω–∏—è (–µ—Å–ª–∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–æ)
        if (data.name !== undefined) {
            const nameValidation = this.validateName(data.name);
            if (!nameValidation.isValid) {
                errors.push(...nameValidation.errors);
            }
        }
        // –í–∞–ª–∏–¥–∞—Ü–∏—è –æ–ø–∏—Å–∞–Ω–∏—è (–µ—Å–ª–∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–æ)
        if (data.description !== undefined) {
            const descriptionValidation = this.validateDescription(data.description);
            if (!descriptionValidation.isValid) {
                errors.push(...descriptionValidation.errors);
            }
        }
        // –í–∞–ª–∏–¥–∞—Ü–∏—è –≤–∏–¥–∏–º–æ—Å—Ç–∏ (–µ—Å–ª–∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–æ)
        if (data.visibility !== undefined) {
            const visibilityValidation = this.validateVisibility(data.visibility);
            if (!visibilityValidation.isValid) {
                errors.push(...visibilityValidation.errors);
            }
        }
        // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ü–≤–µ—Ç–∞ (–µ—Å–ª–∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–æ)
        if (data.color !== undefined) {
            const colorValidation = this.validateColor(data.color);
            if (!colorValidation.isValid) {
                errors.push(...colorValidation.errors);
            }
        }
        // –í–∞–ª–∏–¥–∞—Ü–∏—è –∏–∫–æ–Ω–∫–∏ (–µ—Å–ª–∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–æ)
        if (data.icon !== undefined) {
            const iconValidation = this.validateIcon(data.icon);
            if (!iconValidation.isValid) {
                errors.push(...iconValidation.errors);
            }
        }
        // –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ–∑–∏—Ü–∏–∏ (–µ—Å–ª–∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–æ)
        if (data.position !== undefined) {
            const positionValidation = this.validatePosition(data.position);
            if (!positionValidation.isValid) {
                errors.push(...positionValidation.errors);
            }
        }
        // –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ (–µ—Å–ª–∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–æ)
        if (data.settings !== undefined) {
            const settingsValidation = this.validateSettings(data.settings);
            if (!settingsValidation.isValid) {
                errors.push(...settingsValidation.errors);
            }
        }
        return {
            isValid: errors.length === 0,
            errors
        };
    }
    async validateDelete(id) {
        const errors = [];
        // –í–∞–ª–∏–¥–∞—Ü–∏—è ID
        const idValidation = this.validateId(id);
        if (!idValidation.isValid) {
            errors.push(...idValidation.errors);
        }
        return {
            isValid: errors.length === 0,
            errors
        };
    }
    async validateArchive(id) {
        return this.validateDelete(id); // –¢–µ –∂–µ –ø—Ä–∞–≤–∏–ª–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
    }
    async validateRestore(id) {
        return this.validateDelete(id); // –¢–µ –∂–µ –ø—Ä–∞–≤–∏–ª–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
    }
    async validateReorder(boardIds, positions) {
        const errors = [];
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ—Å–æ–∫ –∏ –ø–æ–∑–∏—Ü–∏–π —Å–æ–≤–ø–∞–¥–∞–µ—Ç
        if (boardIds.length !== positions.length) {
            errors.push({
                field: 'reorder',
                message: '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ—Å–æ–∫ –∏ –ø–æ–∑–∏—Ü–∏–π –¥–æ–ª–∂–Ω–æ —Å–æ–≤–ø–∞–¥–∞—Ç—å',
                code: 'REORDER_MISMATCH'
            });
        }
        // –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–∞–∂–¥–æ–≥–æ ID –¥–æ—Å–∫–∏
        for (const id of boardIds){
            const idValidation = this.validateId(id);
            if (!idValidation.isValid) {
                errors.push(...idValidation.errors);
            }
        }
        // –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–∞–∂–¥–æ–π –ø–æ–∑–∏—Ü–∏–∏
        for (const position of positions){
            const positionValidation = this.validatePosition(position);
            if (!positionValidation.isValid) {
                errors.push(...positionValidation.errors);
            }
        }
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å –ø–æ–∑–∏—Ü–∏–π
        const uniquePositions = new Set(positions);
        if (uniquePositions.size !== positions.length) {
            errors.push({
                field: 'positions',
                message: '–ü–æ–∑–∏—Ü–∏–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º–∏',
                code: 'DUPLICATE_POSITIONS'
            });
        }
        return {
            isValid: errors.length === 0,
            errors
        };
    }
    async validateDuplicate(id, newName) {
        const errors = [];
        // –í–∞–ª–∏–¥–∞—Ü–∏—è –∏—Å—Ö–æ–¥–Ω–æ–≥–æ ID
        const idValidation = this.validateId(id);
        if (!idValidation.isValid) {
            errors.push(...idValidation.errors);
        }
        // –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –Ω–∞–∑–≤–∞–Ω–∏—è (–µ—Å–ª–∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–æ)
        if (newName !== undefined) {
            const nameValidation = this.validateName(newName);
            if (!nameValidation.isValid) {
                errors.push(...nameValidation.errors);
            }
        }
        return {
            isValid: errors.length === 0,
            errors
        };
    }
    // –ü—Ä–∏–≤–∞—Ç–Ω—ã–µ –º–µ—Ç–æ–¥—ã –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π
    validateId(id) {
        const errors = [];
        if (!id) {
            errors.push({
                field: 'id',
                message: 'ID –¥–æ—Å–∫–∏ –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω',
                code: 'REQUIRED'
            });
        } else if (typeof id !== 'string') {
            errors.push({
                field: 'id',
                message: 'ID –¥–æ—Å–∫–∏ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å—Ç—Ä–æ–∫–æ–π',
                code: 'INVALID_TYPE'
            });
        } else if (id.trim().length === 0) {
            errors.push({
                field: 'id',
                message: 'ID –¥–æ—Å–∫–∏ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º',
                code: 'EMPTY'
            });
        }
        return {
            isValid: errors.length === 0,
            errors
        };
    }
    validateName(name) {
        const errors = [];
        if (!name) {
            errors.push({
                field: 'name',
                message: '–ù–∞–∑–≤–∞–Ω–∏–µ –¥–æ—Å–∫–∏ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ',
                code: 'REQUIRED'
            });
        } else if (typeof name !== 'string') {
            errors.push({
                field: 'name',
                message: '–ù–∞–∑–≤–∞–Ω–∏–µ –¥–æ—Å–∫–∏ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Å—Ç—Ä–æ–∫–æ–π',
                code: 'INVALID_TYPE'
            });
        } else {
            const trimmedName = name.trim();
            if (trimmedName.length === 0) {
                errors.push({
                    field: 'name',
                    message: '–ù–∞–∑–≤–∞–Ω–∏–µ –¥–æ—Å–∫–∏ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º',
                    code: 'EMPTY'
                });
            } else if (trimmedName.length < 2) {
                errors.push({
                    field: 'name',
                    message: '–ù–∞–∑–≤–∞–Ω–∏–µ –¥–æ—Å–∫–∏ –¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 2 —Å–∏–º–≤–æ–ª–∞',
                    code: 'TOO_SHORT'
                });
            } else if (trimmedName.length > 100) {
                errors.push({
                    field: 'name',
                    message: '–ù–∞–∑–≤–∞–Ω–∏–µ –¥–æ—Å–∫–∏ –Ω–µ –º–æ–∂–µ—Ç –ø—Ä–µ–≤—ã—à–∞—Ç—å 100 —Å–∏–º–≤–æ–ª–æ–≤',
                    code: 'TOO_LONG'
                });
            }
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–µ —Å–∏–º–≤–æ–ª—ã
            const invalidChars = /[<>"'&]/;
            if (invalidChars.test(trimmedName)) {
                errors.push({
                    field: 'name',
                    message: '–ù–∞–∑–≤–∞–Ω–∏–µ –¥–æ—Å–∫–∏ —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–µ —Å–∏–º–≤–æ–ª—ã',
                    code: 'INVALID_CHARACTERS'
                });
            }
        }
        return {
            isValid: errors.length === 0,
            errors
        };
    }
    validateDescription(description) {
        const errors = [];
        if (description !== null && description !== undefined) {
            if (typeof description !== 'string') {
                errors.push({
                    field: 'description',
                    message: '–û–ø–∏—Å–∞–Ω–∏–µ –¥–æ—Å–∫–∏ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Å—Ç—Ä–æ–∫–æ–π',
                    code: 'INVALID_TYPE'
                });
            } else if (description.length > 1000) {
                errors.push({
                    field: 'description',
                    message: '–û–ø–∏—Å–∞–Ω–∏–µ –¥–æ—Å–∫–∏ –Ω–µ –º–æ–∂–µ—Ç –ø—Ä–µ–≤—ã—à–∞—Ç—å 1000 —Å–∏–º–≤–æ–ª–æ–≤',
                    code: 'TOO_LONG'
                });
            }
        }
        return {
            isValid: errors.length === 0,
            errors
        };
    }
    validateProjectId(projectId) {
        const errors = [];
        if (!projectId) {
            errors.push({
                field: 'projectId',
                message: 'ID –ø—Ä–æ–µ–∫—Ç–∞ –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω',
                code: 'REQUIRED'
            });
        } else if (typeof projectId !== 'string') {
            errors.push({
                field: 'projectId',
                message: 'ID –ø—Ä–æ–µ–∫—Ç–∞ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å—Ç—Ä–æ–∫–æ–π',
                code: 'INVALID_TYPE'
            });
        } else if (projectId.trim().length === 0) {
            errors.push({
                field: 'projectId',
                message: 'ID –ø—Ä–æ–µ–∫—Ç–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º',
                code: 'EMPTY'
            });
        }
        return {
            isValid: errors.length === 0,
            errors
        };
    }
    validateVisibility(visibility) {
        const errors = [];
        const validVisibilities = [
            'private',
            'team',
            'public'
        ];
        if (!validVisibilities.includes(visibility)) {
            errors.push({
                field: 'visibility',
                message: `–í–∏–¥–∏–º–æ—Å—Ç—å –¥–æ—Å–∫–∏ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ–¥–Ω–æ–π –∏–∑: ${validVisibilities.join(', ')}`,
                code: 'INVALID_VALUE'
            });
        }
        return {
            isValid: errors.length === 0,
            errors
        };
    }
    validateColor(color) {
        const errors = [];
        if (typeof color !== 'string') {
            errors.push({
                field: 'color',
                message: '–¶–≤–µ—Ç –¥–æ—Å–∫–∏ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å—Ç—Ä–æ–∫–æ–π',
                code: 'INVALID_TYPE'
            });
        } else {
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ HEX —Ü–≤–µ—Ç–∞
            const hexColorRegex = /^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/;
            if (!hexColorRegex.test(color)) {
                errors.push({
                    field: 'color',
                    message: '–¶–≤–µ—Ç –¥–æ—Å–∫–∏ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ —Ñ–æ—Ä–º–∞—Ç–µ HEX (#RRGGBB –∏–ª–∏ #RGB)',
                    code: 'INVALID_FORMAT'
                });
            }
        }
        return {
            isValid: errors.length === 0,
            errors
        };
    }
    validateIcon(icon) {
        const errors = [];
        if (icon !== null && icon !== undefined) {
            if (typeof icon !== 'string') {
                errors.push({
                    field: 'icon',
                    message: '–ò–∫–æ–Ω–∫–∞ –¥–æ—Å–∫–∏ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Å—Ç—Ä–æ–∫–æ–π',
                    code: 'INVALID_TYPE'
                });
            } else if (icon.length > 50) {
                errors.push({
                    field: 'icon',
                    message: '–ò–∫–æ–Ω–∫–∞ –¥–æ—Å–∫–∏ –Ω–µ –º–æ–∂–µ—Ç –ø—Ä–µ–≤—ã—à–∞—Ç—å 50 —Å–∏–º–≤–æ–ª–æ–≤',
                    code: 'TOO_LONG'
                });
            }
        }
        return {
            isValid: errors.length === 0,
            errors
        };
    }
    validatePosition(position) {
        const errors = [];
        if (typeof position !== 'number') {
            errors.push({
                field: 'position',
                message: '–ü–æ–∑–∏—Ü–∏—è –¥–æ—Å–∫–∏ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —á–∏—Å–ª–æ–º',
                code: 'INVALID_TYPE'
            });
        } else if (!Number.isInteger(position)) {
            errors.push({
                field: 'position',
                message: '–ü–æ–∑–∏—Ü–∏—è –¥–æ—Å–∫–∏ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Ü–µ–ª—ã–º —á–∏—Å–ª–æ–º',
                code: 'INVALID_VALUE'
            });
        } else if (position < 0) {
            errors.push({
                field: 'position',
                message: '–ü–æ–∑–∏—Ü–∏—è –¥–æ—Å–∫–∏ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–π',
                code: 'INVALID_VALUE'
            });
        }
        return {
            isValid: errors.length === 0,
            errors
        };
    }
    validateSettings(settings) {
        const errors = [];
        if (settings !== null && settings !== undefined) {
            if (typeof settings !== 'object') {
                errors.push({
                    field: 'settings',
                    message: '–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–æ—Å–∫–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ–±—ä–µ–∫—Ç–æ–º',
                    code: 'INVALID_TYPE'
                });
            } else {
                // –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫
                if (settings.allowTaskCreation !== undefined && typeof settings.allowTaskCreation !== 'boolean') {
                    errors.push({
                        field: 'settings.allowTaskCreation',
                        message: 'allowTaskCreation –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –±—É–ª–µ–≤—ã–º –∑–Ω–∞—á–µ–Ω–∏–µ–º',
                        code: 'INVALID_TYPE'
                    });
                }
                if (settings.allowColumnReordering !== undefined && typeof settings.allowColumnReordering !== 'boolean') {
                    errors.push({
                        field: 'settings.allowColumnReordering',
                        message: 'allowColumnReordering –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –±—É–ª–µ–≤—ã–º –∑–Ω–∞—á–µ–Ω–∏–µ–º',
                        code: 'INVALID_TYPE'
                    });
                }
                if (settings.enableTaskLimits !== undefined && typeof settings.enableTaskLimits !== 'boolean') {
                    errors.push({
                        field: 'settings.enableTaskLimits',
                        message: 'enableTaskLimits –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –±—É–ª–µ–≤—ã–º –∑–Ω–∞—á–µ–Ω–∏–µ–º',
                        code: 'INVALID_TYPE'
                    });
                }
                if (settings.defaultTaskPriority !== undefined) {
                    const validPriorities = [
                        'low',
                        'medium',
                        'high',
                        'urgent'
                    ];
                    if (!validPriorities.includes(settings.defaultTaskPriority)) {
                        errors.push({
                            field: 'settings.defaultTaskPriority',
                            message: `defaultTaskPriority –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ–¥–Ω–∏–º –∏–∑: ${validPriorities.join(', ')}`,
                            code: 'INVALID_VALUE'
                        });
                    }
                }
                if (settings.autoArchiveCompletedTasks !== undefined && typeof settings.autoArchiveCompletedTasks !== 'boolean') {
                    errors.push({
                        field: 'settings.autoArchiveCompletedTasks',
                        message: 'autoArchiveCompletedTasks –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –±—É–ª–µ–≤—ã–º –∑–Ω–∞—á–µ–Ω–∏–µ–º',
                        code: 'INVALID_TYPE'
                    });
                }
            }
        }
        return {
            isValid: errors.length === 0,
            errors
        };
    }
}
}}),
"[project]/src/services/implementations/permission.service.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname } = __turbopack_context__;
{
/**
 * –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å–µ—Ä–≤–∏—Å–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π –¥–ª—è –¥–æ—Å–æ–∫
 * –£–ø—Ä–∞–≤–ª—è–µ—Ç –ø—Ä–∞–≤–∞–º–∏ –¥–æ—Å—Ç—É–ø–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∫ –¥–æ—Å–∫–∞–º –∏ –ø—Ä–æ–µ–∫—Ç–∞–º
 */ __turbopack_context__.s({
    "PermissionService": (()=>PermissionService)
});
class PermissionService {
    databaseAdapter;
    constructor(databaseAdapter){
        this.databaseAdapter = databaseAdapter;
    }
    /**
   * –ü–æ–ª—É—á–∞–µ—Ç —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –¥–æ—Å–∫–∏
   */ async getUserPermissions(boardId, userId) {
        try {
            // –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –¥–æ—Å–∫–µ –∏ –ø—Ä–æ–µ–∫—Ç–µ
            const boardQuery = `
        SELECT b.project_id, b.created_by, b.visibility,
               p.creator_id as project_owner
        FROM boards b
        JOIN projects p ON b.project_id = p.id
        WHERE b.id = ?
      `;
            const boardResult = await this.databaseAdapter.query(boardQuery, [
                boardId
            ]);
            if (!boardResult.rows || boardResult.rows.length === 0) {
                return {
                    canView: false,
                    canEdit: false,
                    canDelete: false,
                    canManage: false
                };
            }
            const board = boardResult.rows[0];
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á–ª–µ–Ω—Å—Ç–≤–æ –≤ –ø—Ä–æ–µ–∫—Ç–µ
            const memberQuery = `
        SELECT role FROM project_members 
        WHERE project_id = ? AND user_id = ?
      `;
            const memberResult = await this.databaseAdapter.query(memberQuery, [
                board.project_id,
                userId
            ]);
            const userRole = memberResult.rows?.[0]?.role;
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–æ–ª–∏ –∏ –≤–ª–∞–¥–µ–Ω–∏—è
            const isProjectOwner = board.project_owner === userId;
            const isBoardCreator = board.created_by === userId;
            const isPublicBoard = board.visibility === 'public';
            let canView = false;
            let canEdit = false;
            let canDelete = false;
            let canManage = false;
            if (isProjectOwner) {
                // –í–ª–∞–¥–µ–ª–µ—Ü –ø—Ä–æ–µ–∫—Ç–∞ –∏–º–µ–µ—Ç –≤—Å–µ –ø—Ä–∞–≤–∞
                canView = true;
                canEdit = true;
                canDelete = true;
                canManage = true;
            } else if (userRole) {
                // –ß–ª–µ–Ω –ø—Ä–æ–µ–∫—Ç–∞
                switch(userRole){
                    case 'admin':
                        canView = true;
                        canEdit = true;
                        canDelete = true;
                        canManage = true;
                        break;
                    case 'member':
                        canView = true;
                        canEdit = true;
                        canDelete = isBoardCreator;
                        canManage = false;
                        break;
                    case 'viewer':
                        canView = true;
                        canEdit = false;
                        canDelete = false;
                        canManage = false;
                        break;
                }
            } else if (isPublicBoard) {
                // –ü—É–±–ª–∏—á–Ω–∞—è –¥–æ—Å–∫–∞ - —Ç–æ–ª—å–∫–æ –ø—Ä–æ—Å–º–æ—Ç—Ä
                canView = true;
                canEdit = false;
                canDelete = false;
                canManage = false;
            }
            return {
                canView,
                canEdit,
                canDelete,
                canManage
            };
        } catch (error) {
            console.error('Error getting user permissions:', error);
            return {
                canView: false,
                canEdit: false,
                canDelete: false,
                canManage: false
            };
        }
    }
    /**
   * –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –º–æ–∂–µ—Ç –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –¥–æ—Å–∫—É
   */ async canUserViewBoard(boardId, userId) {
        const permissions = await this.getUserPermissions(boardId, userId);
        return permissions.canView;
    }
    /**
   * –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –º–æ–∂–µ—Ç –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–æ—Å–∫—É
   */ async canUserEditBoard(boardId, userId) {
        const permissions = await this.getUserPermissions(boardId, userId);
        return permissions.canEdit;
    }
    /**
   * –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –º–æ–∂–µ—Ç –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–¥–∞–ª–∏—Ç—å –¥–æ—Å–∫—É
   */ async canUserDeleteBoard(boardId, userId) {
        const permissions = await this.getUserPermissions(boardId, userId);
        return permissions.canDelete;
    }
    /**
   * –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –º–æ–∂–µ—Ç –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–≤–∞—Ç—å –¥–æ—Å–∫–∏ –≤ –ø—Ä–æ–µ–∫—Ç–µ
   */ async canUserCreateBoard(projectId, userId) {
        try {
            console.log('canUserCreateBoard called with:', {
                projectId,
                userId
            });
            // –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º —Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —Å–∏—Å—Ç–µ–º–µ
            const user = await this.databaseAdapter.getUserById(userId);
            if (!user) {
                console.log('User not found');
                return false;
            }
            console.log('User role:', user.role);
            // –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –º–æ–≥—É—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –¥–æ—Å–∫–∏ –≤ –ª—é–±–æ–º –ø—Ä–æ–µ–∫—Ç–µ
            if (user.role === 'admin') {
                console.log('User is admin - allowing board creation');
                return true;
            }
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–ª–∞–¥–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–æ–º
            const ownerQuery = `
        SELECT creator_id FROM projects WHERE id = $1
      `;
            const ownerResult = await this.databaseAdapter.query(ownerQuery, [
                projectId
            ]);
            console.log('Owner query result:', ownerResult);
            if (!ownerResult || ownerResult.rows.length === 0) {
                console.log('Project not found');
                return false;
            }
            const projectOwner = ownerResult.rows[0].creator_id;
            console.log('Project owner:', projectOwner, 'Current user:', userId);
            if (projectOwner === userId) {
                console.log('User is project owner - allowing board creation');
                return true;
            }
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á–ª–µ–Ω—Å—Ç–≤–æ –≤ –ø—Ä–æ–µ–∫—Ç–µ
            const memberQuery = `
        SELECT role FROM project_members 
        WHERE project_id = $1 AND user_id = $2
      `;
            const memberResult = await this.databaseAdapter.query(memberQuery, [
                projectId,
                userId
            ]);
            console.log('Member query result:', memberResult.rows);
            const userRole = memberResult.rows?.[0]?.role;
            console.log('User role in project:', userRole);
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø—Ä–∞–≤–∞ –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ –¥–æ—Å–æ–∫
            switch(userRole){
                case 'admin':
                case 'member':
                    console.log('User has admin/member role - allowing board creation');
                    return true;
                case 'viewer':
                    console.log('User has viewer role - denying board creation');
                    return false;
                default:
                    console.log('User has no role in project - denying board creation');
                    return false;
            }
        } catch (error) {
            console.error('Error checking board creation permission:', error);
            return false;
        }
    }
}
}}),
"[project]/src/app/api/boards/route.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname, a: __turbopack_async_module__ } = __turbopack_context__;
__turbopack_async_module__(async (__turbopack_handle_async_dependencies__, __turbopack_async_result__) => { try {
__turbopack_context__.s({
    "DELETE": (()=>DELETE),
    "GET": (()=>GET),
    "POST": (()=>POST)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/server.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$auth$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/auth.ts [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__ = __turbopack_context__.i("[project]/node_modules/zod/v4/classic/external.js [app-route] (ecmascript) <export * as z>");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$services$2f$implementations$2f$board$2e$service$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/services/implementations/board.service.ts [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$services$2f$implementations$2f$board$2e$repository$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/services/implementations/board.repository.ts [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$services$2f$implementations$2f$board$2e$validator$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/services/implementations/board.validator.ts [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$services$2f$implementations$2f$permission$2e$service$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/services/implementations/permission.service.ts [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$database$2d$adapter$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/database-adapter.ts [app-route] (ecmascript)");
var __turbopack_async_dependencies__ = __turbopack_handle_async_dependencies__([
    __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$auth$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__,
    __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$database$2d$adapter$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__
]);
([__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$auth$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$database$2d$adapter$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__] = __turbopack_async_dependencies__.then ? (await __turbopack_async_dependencies__)() : __turbopack_async_dependencies__);
;
;
;
;
;
;
;
;
const createBoardSchema = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].object({
    name: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].string().min(1, 'Board name is required'),
    description: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].string().optional(),
    projectId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].string().min(1, 'Project ID is required'),
    visibility: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].enum([
        'private',
        'public'
    ]).default('private'),
    color: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].string().regex(/^#[0-9A-F]{6}$/i, 'Invalid color format').optional()
});
// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤
const boardRepository = new __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$services$2f$implementations$2f$board$2e$repository$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["BoardRepository"](__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$database$2d$adapter$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["dbAdapter"]);
const boardValidator = new __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$services$2f$implementations$2f$board$2e$validator$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["BoardValidator"]();
const permissionService = new __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$services$2f$implementations$2f$permission$2e$service$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["PermissionService"](__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$database$2d$adapter$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["dbAdapter"]);
// –°–æ–∑–¥–∞–µ–º –∑–∞–≥–ª—É—à–∫—É –¥–ª—è event service
const mockEventService = {
    emitBoardCreated: ()=>Promise.resolve(),
    emitBoardUpdated: ()=>Promise.resolve(),
    emitBoardDeleted: ()=>Promise.resolve(),
    emitBoardArchived: ()=>Promise.resolve(),
    emitBoardRestored: ()=>Promise.resolve()
};
const boardService = new __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$services$2f$implementations$2f$board$2e$service$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["BoardService"](boardRepository, boardValidator, permissionService, mockEventService, null // cache service
);
async function GET(request) {
    try {
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        const authResult = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$auth$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["verifyAuth"])(request);
        if (!authResult.success) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: authResult.error
            }, {
                status: 401
            });
        }
        const { userId } = authResult.user;
        const { searchParams } = new URL(request.url);
        const projectId = searchParams.get('projectId');
        if (!projectId || projectId === 'null' || projectId === 'undefined' || projectId.trim() === '') {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: 'ID –ø—Ä–æ–µ–∫—Ç–∞ –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω'
            }, {
                status: 400
            });
        }
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –ø—Ä–æ–µ–∫—Ç—É
        const hasAccess = await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$database$2d$adapter$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["dbAdapter"].hasProjectAccess(userId, projectId);
        if (!hasAccess) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: '–ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –ø—Ä–æ–µ–∫—Ç—É'
            }, {
                status: 403
            });
        }
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–æ–≤—ã–π —Å–µ—Ä–≤–∏—Å –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–æ—Å–æ–∫
        const result = await boardService.getBoardsByProject(projectId, userId, {
            includeArchived: searchParams.get('includeArchived') === 'true',
            sortBy: searchParams.get('sortBy') || 'position',
            sortOrder: searchParams.get('sortOrder') || 'asc'
        });
        if (!result.success) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: result.error
            }, {
                status: 400
            });
        }
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            boards: result.data
        });
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–æ—Å–æ–∫:', error);
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            error: '–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞'
        }, {
            status: 500
        });
    }
}
async function POST(request) {
    try {
        const authResult = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$auth$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["verifyAuth"])(request);
        if (!authResult.success) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: authResult.error
            }, {
                status: 401
            });
        }
        const { userId } = authResult.user;
        const body = await request.json();
        const validatedData = createBoardSchema.parse(body);
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∞–≤–∞ –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ –¥–æ—Å–∫–∏
        const canCreate = await permissionService.canUserCreateBoard(validatedData.projectId, userId);
        if (!canCreate) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: '–ù–µ—Ç –ø—Ä–∞–≤ –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ –¥–æ—Å–æ–∫ –≤ —ç—Ç–æ–º –ø—Ä–æ–µ–∫—Ç–µ'
            }, {
                status: 403
            });
        }
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–æ–≤—ã–π —Å–µ—Ä–≤–∏—Å –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –¥–æ—Å–∫–∏
        const result = await boardService.createBoard({
            name: validatedData.name,
            description: validatedData.description || null,
            projectId: validatedData.projectId,
            visibility: validatedData.visibility,
            color: validatedData.color || '#3B82F6',
            settings: {
                allowTaskCreation: true,
                allowColumnReordering: true,
                enableTaskLimits: false,
                defaultTaskPriority: 'medium',
                autoArchiveCompletedTasks: false
            }
        }, userId);
        if (!result.success) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: result.error
            }, {
                status: 400
            });
        }
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            board: result.data
        }, {
            status: 201
        });
    } catch (error) {
        if (error instanceof __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].ZodError) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: 'Validation error',
                details: error.errors
            }, {
                status: 400
            });
        }
        console.error('Error creating board:', error);
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            error: 'Internal server error'
        }, {
            status: 500
        });
    }
}
async function DELETE(request) {
    try {
        const authResult = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$auth$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["verifyAuth"])(request);
        if (!authResult.success) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: authResult.error
            }, {
                status: 401
            });
        }
        const { user } = authResult;
        const { searchParams } = new URL(request.url);
        const boardId = searchParams.get('boardId');
        if (!boardId) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: 'ID –¥–æ—Å–∫–∏ –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω'
            }, {
                status: 400
            });
        }
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –Ω–∞ —É–¥–∞–ª–µ–Ω–∏–µ –¥–æ—Å–∫–∏
        const canDelete = await permissionService.canUserDeleteBoard(user.id, Number(boardId));
        if (!canDelete) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –¥–æ—Å–∫–∏'
            }, {
                status: 403
            });
        }
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–æ–≤—ã–π —Å–µ—Ä–≤–∏—Å –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –¥–æ—Å–∫–∏
        const result = await boardService.delete(boardId, user.id);
        if (!result.success) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: result.error
            }, {
                status: 400
            });
        }
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            message: '–î–æ—Å–∫–∞ —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–∞'
        }, {
            status: 200
        });
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –¥–æ—Å–∫–∏:', error);
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            error: '–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞'
        }, {
            status: 500
        });
    }
}
__turbopack_async_result__();
} catch(e) { __turbopack_async_result__(e); } }, false);}),

};

//# sourceMappingURL=%5Broot-of-the-server%5D__f2bf92a5._.js.map