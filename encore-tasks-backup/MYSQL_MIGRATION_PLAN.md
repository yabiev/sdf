# План миграции с PostgreSQL на MySQL

## Анализ текущей структуры

### Текущие сущности в системе:
1. **users** - пользователи системы
2. **projects** - проекты
3. **project_members** - участники проектов
4. **boards** - доски для задач
5. **columns** - колонки на досках
6. **tasks** - задачи
7. **task_assignees** - назначения задач
8. **tags** - теги
9. **task_tags** - связи задач и тегов
10. **attachments** - вложения
11. **comments** - комментарии
12. **notifications** - уведомления
13. **activity_log** - журнал действий
14. **user_sessions** - сессии пользователей
15. **system_settings** - настройки системы

### Текущие API endpoints:
- `/api/auth/login` - авторизация
- `/api/auth/logout` - выход
- `/api/auth/register` - регистрация
- `/api/users` - управление пользователями
- `/api/projects` - управление проектами
- `/api/boards` - управление досками
- `/api/columns` - управление колонками
- `/api/tasks` - управление задачами

## План миграции

### Этап 1: Подготовка MySQL инфраструктуры
1. Создание конфигурации подключения к MySQL
2. Создание схемы базы данных MySQL
3. Адаптация типов данных PostgreSQL → MySQL
4. Создание индексов для оптимизации производительности

### Этап 2: Адаптация кода подключения
1. Замена библиотеки `pg` на `mysql2`
2. Обновление файла `src/lib/db.ts`
3. Адаптация SQL запросов под синтаксис MySQL
4. Обновление функций проверки доступности БД

### Этап 3: Обновление API endpoints
1. Адаптация всех SQL запросов в API routes
2. Замена PostgreSQL-специфичных функций
3. Обновление обработки ошибок
4. Тестирование всех endpoints

### Этап 4: Обновление временной базы данных
1. Сохранение совместимости с temp-db.json
2. Обеспечение плавного переключения между MySQL и temp-db

### Этап 5: Тестирование и оптимизация
1. Полное тестирование всех функций
2. Оптимизация запросов для MySQL
3. Настройка индексов для производительности

## Ключевые различия PostgreSQL vs MySQL

### Типы данных:
- `UUID` → `CHAR(36)` или `BINARY(16)`
- `JSONB` → `JSON`
- `TIMESTAMP WITH TIME ZONE` → `TIMESTAMP`
- `TEXT` → `LONGTEXT`
- `INET` → `VARCHAR(45)`

### Функции:
- `uuid_generate_v4()` → `UUID()`
- `CURRENT_TIMESTAMP` → `NOW()`
- `gin_trgm_ops` → `FULLTEXT` индексы

### Синтаксис:
- `$1, $2, $3` → `?, ?, ?` (параметризованные запросы)
- `RETURNING` → отдельный SELECT после INSERT
- `ON CONFLICT` → `ON DUPLICATE KEY UPDATE`

## Преимущества миграции на MySQL

1. **Широкая поддержка хостинг-провайдеров**
2. **Простота развертывания**
3. **Отличная производительность для веб-приложений**
4. **Богатая экосистема инструментов**
5. **Меньшее потребление ресурсов**

## Риски и их минимизация

1. **Потеря данных** - создание резервных копий перед миграцией
2. **Снижение производительности** - тщательная настройка индексов
3. **Совместимость запросов** - полное тестирование всех endpoints
4. **Функциональность** - сохранение всех существующих возможностей

## Временные затраты

- Этап 1: 2-3 часа
- Этап 2: 1-2 часа
- Этап 3: 3-4 часа
- Этап 4: 1 час
- Этап 5: 2-3 часа

**Общее время: 9-13 часов**

## Следующие шаги

1. Создание MySQL схемы
2. Обновление конфигурации подключения
3. Пошаговая замена PostgreSQL на MySQL
4. Тестирование каждого компонента
5. Финальная проверка всей системы